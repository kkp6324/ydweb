/* Zepto 1.2.0 - zepto event ajax form ie fx fx_methods data callbacks selector - zeptojs.com/license */
!function(t,e){"function"==typeof define&&define.amd?define(function(){return e(t)}):e(t)}(this,function(t){var e=function(){function L(t){return null==t?String(t):C[N.call(t)]||"object"}function $(t){return"function"==L(t)}function F(t){return null!=t&&t==t.window}function z(t){return null!=t&&t.nodeType==t.DOCUMENT_NODE}function Z(t){return"object"==L(t)}function q(t){return Z(t)&&!F(t)&&Object.getPrototypeOf(t)==Object.prototype}function M(t){var e=!!t&&"length"in t&&t.length,n=i.type(t);return"function"!=n&&!F(t)&&("array"==n||0===e||"number"==typeof e&&e>0&&e-1 in t)}function R(t){return o.call(t,function(t){return null!=t})}function _(t){return t.length>0?i.fn.concat.apply([],t):t}function I(t){return t.replace(/::/g,"/").replace(/([A-Z]+)([A-Z][a-z])/g,"$1_$2").replace(/([a-z\d])([A-Z])/g,"$1_$2").replace(/_/g,"-").toLowerCase()}function H(t){return t in l?l[t]:l[t]=new RegExp("(^|\\s)"+t+"(\\s|$)")}function V(t,e){return"number"!=typeof e||h[I(t)]?e:e+"px"}function B(t){var e,n;return c[t]||(e=f.createElement(t),f.body.appendChild(e),n=getComputedStyle(e,"").getPropertyValue("display"),e.parentNode.removeChild(e),"none"==n&&(n="block"),c[t]=n),c[t]}function X(t){return"children"in t?u.call(t.children):i.map(t.childNodes,function(t){return 1==t.nodeType?t:void 0})}function U(t,e){var n,i=t?t.length:0;for(n=0;i>n;n++)this[n]=t[n];this.length=i,this.selector=e||""}function W(t,i,r){for(n in i)r&&(q(i[n])||k(i[n]))?(q(i[n])&&!q(t[n])&&(t[n]={}),k(i[n])&&!k(t[n])&&(t[n]=[]),W(t[n],i[n],r)):i[n]!==e&&(t[n]=i[n])}function J(t,e){return null==e?i(t):i(t).filter(e)}function Y(t,e,n,i){return $(e)?e.call(t,n,i):e}function G(t,e,n){null==n?t.removeAttribute(e):t.setAttribute(e,n)}function K(t,n){var i=t.className||"",r=i&&i.baseVal!==e;return n===e?r?i.baseVal:i:void(r?i.baseVal=n:t.className=n)}function Q(t){try{return t?"true"==t||("false"==t?!1:"null"==t?null:+t+""==t?+t:/^[\[\{]/.test(t)?i.parseJSON(t):t):t}catch(e){return t}}function tt(t,e){e(t);for(var n=0,i=t.childNodes.length;i>n;n++)tt(t.childNodes[n],e)}var e,n,i,r,O,P,s=[],a=s.concat,o=s.filter,u=s.slice,f=t.document,c={},l={},h={"column-count":1,columns:1,"font-weight":1,"line-height":1,opacity:1,"z-index":1,zoom:1},p=/^\s*<(\w+|!)[^>]*>/,d=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,m=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,g=/^(?:body|html)$/i,v=/([A-Z])/g,y=["val","css","html","text","data","width","height","offset"],x=["after","prepend","before","append"],b=f.createElement("table"),E=f.createElement("tr"),w={tr:f.createElement("tbody"),tbody:b,thead:b,tfoot:b,td:E,th:E,"*":f.createElement("div")},j=/complete|loaded|interactive/,T=/^[\w-]*$/,C={},N=C.toString,S={},A=f.createElement("div"),D={tabindex:"tabIndex",readonly:"readOnly","for":"htmlFor","class":"className",maxlength:"maxLength",cellspacing:"cellSpacing",cellpadding:"cellPadding",rowspan:"rowSpan",colspan:"colSpan",usemap:"useMap",frameborder:"frameBorder",contenteditable:"contentEditable"},k=Array.isArray||function(t){return t instanceof Array};return S.matches=function(t,e){if(!e||!t||1!==t.nodeType)return!1;var n=t.matches||t.webkitMatchesSelector||t.mozMatchesSelector||t.oMatchesSelector||t.matchesSelector;if(n)return n.call(t,e);var i,r=t.parentNode,s=!r;return s&&(r=A).appendChild(t),i=~S.qsa(r,e).indexOf(t),s&&A.removeChild(t),i},O=function(t){return t.replace(/-+(.)?/g,function(t,e){return e?e.toUpperCase():""})},P=function(t){return o.call(t,function(e,n){return t.indexOf(e)==n})},S.fragment=function(t,n,r){var s,a,o;return d.test(t)&&(s=i(f.createElement(RegExp.$1))),s||(t.replace&&(t=t.replace(m,"<$1></$2>")),n===e&&(n=p.test(t)&&RegExp.$1),n in w||(n="*"),o=w[n],o.innerHTML=""+t,s=i.each(u.call(o.childNodes),function(){o.removeChild(this)})),q(r)&&(a=i(s),i.each(r,function(t,e){y.indexOf(t)>-1?a[t](e):a.attr(t,e)})),s},S.Z=function(t,e){return new U(t,e)},S.isZ=function(t){return t instanceof S.Z},S.init=function(t,n){var r;if(!t)return S.Z();if("string"==typeof t)if(t=t.trim(),"<"==t[0]&&p.test(t))r=S.fragment(t,RegExp.$1,n),t=null;else{if(n!==e)return i(n).find(t);r=S.qsa(f,t)}else{if($(t))return i(f).ready(t);if(S.isZ(t))return t;if(k(t))r=R(t);else if(Z(t))r=[t],t=null;else if(p.test(t))r=S.fragment(t.trim(),RegExp.$1,n),t=null;else{if(n!==e)return i(n).find(t);r=S.qsa(f,t)}}return S.Z(r,t)},i=function(t,e){return S.init(t,e)},i.extend=function(t){var e,n=u.call(arguments,1);return"boolean"==typeof t&&(e=t,t=n.shift()),n.forEach(function(n){W(t,n,e)}),t},S.qsa=function(t,e){var n,i="#"==e[0],r=!i&&"."==e[0],s=i||r?e.slice(1):e,a=T.test(s);return t.getElementById&&a&&i?(n=t.getElementById(s))?[n]:[]:1!==t.nodeType&&9!==t.nodeType&&11!==t.nodeType?[]:u.call(a&&!i&&t.getElementsByClassName?r?t.getElementsByClassName(s):t.getElementsByTagName(e):t.querySelectorAll(e))},i.contains=f.documentElement.contains?function(t,e){return t!==e&&t.contains(e)}:function(t,e){for(;e&&(e=e.parentNode);)if(e===t)return!0;return!1},i.type=L,i.isFunction=$,i.isWindow=F,i.isArray=k,i.isPlainObject=q,i.isEmptyObject=function(t){var e;for(e in t)return!1;return!0},i.isNumeric=function(t){var e=Number(t),n=typeof t;return null!=t&&"boolean"!=n&&("string"!=n||t.length)&&!isNaN(e)&&isFinite(e)||!1},i.inArray=function(t,e,n){return s.indexOf.call(e,t,n)},i.camelCase=O,i.trim=function(t){return null==t?"":String.prototype.trim.call(t)},i.uuid=0,i.support={},i.expr={},i.noop=function(){},i.map=function(t,e){var n,r,s,i=[];if(M(t))for(r=0;r<t.length;r++)n=e(t[r],r),null!=n&&i.push(n);else for(s in t)n=e(t[s],s),null!=n&&i.push(n);return _(i)},i.each=function(t,e){var n,i;if(M(t)){for(n=0;n<t.length;n++)if(e.call(t[n],n,t[n])===!1)return t}else for(i in t)if(e.call(t[i],i,t[i])===!1)return t;return t},i.grep=function(t,e){return o.call(t,e)},t.JSON&&(i.parseJSON=JSON.parse),i.each("Boolean Number String Function Array Date RegExp Object Error".split(" "),function(t,e){C["[object "+e+"]"]=e.toLowerCase()}),i.fn={constructor:S.Z,length:0,forEach:s.forEach,reduce:s.reduce,push:s.push,sort:s.sort,splice:s.splice,indexOf:s.indexOf,concat:function(){var t,e,n=[];for(t=0;t<arguments.length;t++)e=arguments[t],n[t]=S.isZ(e)?e.toArray():e;return a.apply(S.isZ(this)?this.toArray():this,n)},map:function(t){return i(i.map(this,function(e,n){return t.call(e,n,e)}))},slice:function(){return i(u.apply(this,arguments))},ready:function(t){return j.test(f.readyState)&&f.body?t(i):f.addEventListener("DOMContentLoaded",function(){t(i)},!1),this},get:function(t){return t===e?u.call(this):this[t>=0?t:t+this.length]},toArray:function(){return this.get()},size:function(){return this.length},remove:function(){return this.each(function(){null!=this.parentNode&&this.parentNode.removeChild(this)})},each:function(t){return s.every.call(this,function(e,n){return t.call(e,n,e)!==!1}),this},filter:function(t){return $(t)?this.not(this.not(t)):i(o.call(this,function(e){return S.matches(e,t)}))},add:function(t,e){return i(P(this.concat(i(t,e))))},is:function(t){return this.length>0&&S.matches(this[0],t)},not:function(t){var n=[];if($(t)&&t.call!==e)this.each(function(e){t.call(this,e)||n.push(this)});else{var r="string"==typeof t?this.filter(t):M(t)&&$(t.item)?u.call(t):i(t);this.forEach(function(t){r.indexOf(t)<0&&n.push(t)})}return i(n)},has:function(t){return this.filter(function(){return Z(t)?i.contains(this,t):i(this).find(t).size()})},eq:function(t){return-1===t?this.slice(t):this.slice(t,+t+1)},first:function(){var t=this[0];return t&&!Z(t)?t:i(t)},last:function(){var t=this[this.length-1];return t&&!Z(t)?t:i(t)},find:function(t){var e,n=this;return e=t?"object"==typeof t?i(t).filter(function(){var t=this;return s.some.call(n,function(e){return i.contains(e,t)})}):1==this.length?i(S.qsa(this[0],t)):this.map(function(){return S.qsa(this,t)}):i()},closest:function(t,e){var n=[],r="object"==typeof t&&i(t);return this.each(function(i,s){for(;s&&!(r?r.indexOf(s)>=0:S.matches(s,t));)s=s!==e&&!z(s)&&s.parentNode;s&&n.indexOf(s)<0&&n.push(s)}),i(n)},parents:function(t){for(var e=[],n=this;n.length>0;)n=i.map(n,function(t){return(t=t.parentNode)&&!z(t)&&e.indexOf(t)<0?(e.push(t),t):void 0});return J(e,t)},parent:function(t){return J(P(this.pluck("parentNode")),t)},children:function(t){return J(this.map(function(){return X(this)}),t)},contents:function(){return this.map(function(){return this.contentDocument||u.call(this.childNodes)})},siblings:function(t){return J(this.map(function(t,e){return o.call(X(e.parentNode),function(t){return t!==e})}),t)},empty:function(){return this.each(function(){this.innerHTML=""})},pluck:function(t){return i.map(this,function(e){return e[t]})},show:function(){return this.each(function(){"none"==this.style.display&&(this.style.display=""),"none"==getComputedStyle(this,"").getPropertyValue("display")&&(this.style.display=B(this.nodeName))})},replaceWith:function(t){return this.before(t).remove()},wrap:function(t){var e=$(t);if(this[0]&&!e)var n=i(t).get(0),r=n.parentNode||this.length>1;return this.each(function(s){i(this).wrapAll(e?t.call(this,s):r?n.cloneNode(!0):n)})},wrapAll:function(t){if(this[0]){i(this[0]).before(t=i(t));for(var e;(e=t.children()).length;)t=e.first();i(t).append(this)}return this},wrapInner:function(t){var e=$(t);return this.each(function(n){var r=i(this),s=r.contents(),a=e?t.call(this,n):t;s.length?s.wrapAll(a):r.append(a)})},unwrap:function(){return this.parent().each(function(){i(this).replaceWith(i(this).children())}),this},clone:function(){return this.map(function(){return this.cloneNode(!0)})},hide:function(){return this.css("display","none")},toggle:function(t){return this.each(function(){var n=i(this);(t===e?"none"==n.css("display"):t)?n.show():n.hide()})},prev:function(t){return i(this.pluck("previousElementSibling")).filter(t||"*")},next:function(t){return i(this.pluck("nextElementSibling")).filter(t||"*")},html:function(t){return 0 in arguments?this.each(function(e){var n=this.innerHTML;i(this).empty().append(Y(this,t,e,n))}):0 in this?this[0].innerHTML:null},text:function(t){return 0 in arguments?this.each(function(e){var n=Y(this,t,e,this.textContent);this.textContent=null==n?"":""+n}):0 in this?this.pluck("textContent").join(""):null},attr:function(t,i){var r;return"string"!=typeof t||1 in arguments?this.each(function(e){if(1===this.nodeType)if(Z(t))for(n in t)G(this,n,t[n]);else G(this,t,Y(this,i,e,this.getAttribute(t)))}):0 in this&&1==this[0].nodeType&&null!=(r=this[0].getAttribute(t))?r:e},removeAttr:function(t){return this.each(function(){1===this.nodeType&&t.split(" ").forEach(function(t){G(this,t)},this)})},prop:function(t,e){return t=D[t]||t,1 in arguments?this.each(function(n){this[t]=Y(this,e,n,this[t])}):this[0]&&this[0][t]},removeProp:function(t){return t=D[t]||t,this.each(function(){delete this[t]})},data:function(t,n){var i="data-"+t.replace(v,"-$1").toLowerCase(),r=1 in arguments?this.attr(i,n):this.attr(i);return null!==r?Q(r):e},val:function(t){return 0 in arguments?(null==t&&(t=""),this.each(function(e){this.value=Y(this,t,e,this.value)})):this[0]&&(this[0].multiple?i(this[0]).find("option").filter(function(){return this.selected}).pluck("value"):this[0].value)},offset:function(e){if(e)return this.each(function(t){var n=i(this),r=Y(this,e,t,n.offset()),s=n.offsetParent().offset(),a={top:r.top-s.top,left:r.left-s.left};"static"==n.css("position")&&(a.position="relative"),n.css(a)});if(!this.length)return null;if(f.documentElement!==this[0]&&!i.contains(f.documentElement,this[0]))return{top:0,left:0};var n=this[0].getBoundingClientRect();return{left:n.left+t.pageXOffset,top:n.top+t.pageYOffset,width:Math.round(n.width),height:Math.round(n.height)}},css:function(t,e){if(arguments.length<2){var r=this[0];if("string"==typeof t){if(!r)return;return r.style[O(t)]||getComputedStyle(r,"").getPropertyValue(t)}if(k(t)){if(!r)return;var s={},a=getComputedStyle(r,"");return i.each(t,function(t,e){s[e]=r.style[O(e)]||a.getPropertyValue(e)}),s}}var o="";if("string"==L(t))e||0===e?o=I(t)+":"+V(t,e):this.each(function(){this.style.removeProperty(I(t))});else for(n in t)t[n]||0===t[n]?o+=I(n)+":"+V(n,t[n])+";":this.each(function(){this.style.removeProperty(I(n))});return this.each(function(){this.style.cssText+=";"+o})},index:function(t){return t?this.indexOf(i(t)[0]):this.parent().children().indexOf(this[0])},hasClass:function(t){return t?s.some.call(this,function(t){return this.test(K(t))},H(t)):!1},addClass:function(t){return t?this.each(function(e){if("className"in this){r=[];var n=K(this),s=Y(this,t,e,n);s.split(/\s+/g).forEach(function(t){i(this).hasClass(t)||r.push(t)},this),r.length&&K(this,n+(n?" ":"")+r.join(" "))}}):this},removeClass:function(t){return this.each(function(n){if("className"in this){if(t===e)return K(this,"");r=K(this),Y(this,t,n,r).split(/\s+/g).forEach(function(t){r=r.replace(H(t)," ")}),K(this,r.trim())}})},toggleClass:function(t,n){return t?this.each(function(r){var s=i(this),a=Y(this,t,r,K(this));a.split(/\s+/g).forEach(function(t){(n===e?!s.hasClass(t):n)?s.addClass(t):s.removeClass(t)})}):this},scrollTop:function(t){if(this.length){var n="scrollTop"in this[0];return t===e?n?this[0].scrollTop:this[0].pageYOffset:this.each(n?function(){this.scrollTop=t}:function(){this.scrollTo(this.scrollX,t)})}},scrollLeft:function(t){if(this.length){var n="scrollLeft"in this[0];return t===e?n?this[0].scrollLeft:this[0].pageXOffset:this.each(n?function(){this.scrollLeft=t}:function(){this.scrollTo(t,this.scrollY)})}},position:function(){if(this.length){var t=this[0],e=this.offsetParent(),n=this.offset(),r=g.test(e[0].nodeName)?{top:0,left:0}:e.offset();return n.top-=parseFloat(i(t).css("margin-top"))||0,n.left-=parseFloat(i(t).css("margin-left"))||0,r.top+=parseFloat(i(e[0]).css("border-top-width"))||0,r.left+=parseFloat(i(e[0]).css("border-left-width"))||0,{top:n.top-r.top,left:n.left-r.left}}},offsetParent:function(){return this.map(function(){for(var t=this.offsetParent||f.body;t&&!g.test(t.nodeName)&&"static"==i(t).css("position");)t=t.offsetParent;return t})}},i.fn.detach=i.fn.remove,["width","height"].forEach(function(t){var n=t.replace(/./,function(t){return t[0].toUpperCase()});i.fn[t]=function(r){var s,a=this[0];return r===e?F(a)?a["inner"+n]:z(a)?a.documentElement["scroll"+n]:(s=this.offset())&&s[t]:this.each(function(e){a=i(this),a.css(t,Y(this,r,e,a[t]()))})}}),x.forEach(function(n,r){var s=r%2;i.fn[n]=function(){var n,o,a=i.map(arguments,function(t){var r=[];return n=L(t),"array"==n?(t.forEach(function(t){return t.nodeType!==e?r.push(t):i.zepto.isZ(t)?r=r.concat(t.get()):void(r=r.concat(S.fragment(t)))}),r):"object"==n||null==t?t:S.fragment(t)}),u=this.length>1;return a.length<1?this:this.each(function(e,n){o=s?n:n.parentNode,n=0==r?n.nextSibling:1==r?n.firstChild:2==r?n:null;var c=i.contains(f.documentElement,o);a.forEach(function(e){if(u)e=e.cloneNode(!0);else if(!o)return i(e).remove();o.insertBefore(e,n),c&&tt(e,function(e){if(!(null==e.nodeName||"SCRIPT"!==e.nodeName.toUpperCase()||e.type&&"text/javascript"!==e.type||e.src)){var n=e.ownerDocument?e.ownerDocument.defaultView:t;n.eval.call(n,e.innerHTML)}})})})},i.fn[s?n+"To":"insert"+(r?"Before":"After")]=function(t){return i(t)[n](this),this}}),S.Z.prototype=U.prototype=i.fn,S.uniq=P,S.deserializeValue=Q,i.zepto=S,i}();return t.Zepto=e,void 0===t.$&&(t.$=e),function(e){function h(t){return t._zid||(t._zid=n++)}function p(t,e,n,i){if(e=d(e),e.ns)var r=m(e.ns);return(o[h(t)]||[]).filter(function(t){return t&&(!e.e||t.e==e.e)&&(!e.ns||r.test(t.ns))&&(!n||h(t.fn)===h(n))&&(!i||t.sel==i)})}function d(t){var e=(""+t).split(".");return{e:e[0],ns:e.slice(1).sort().join(" ")}}function m(t){return new RegExp("(?:^| )"+t.replace(" "," .* ?")+"(?: |$)")}function g(t,e){return t.del&&!f&&t.e in c||!!e}function v(t){return l[t]||f&&c[t]||t}function y(t,n,r,s,a,u,f){var c=h(t),p=o[c]||(o[c]=[]);n.split(/\s/).forEach(function(n){if("ready"==n)return e(document).ready(r);var o=d(n);o.fn=r,o.sel=a,o.e in l&&(r=function(t){var n=t.relatedTarget;return!n||n!==this&&!e.contains(this,n)?o.fn.apply(this,arguments):void 0}),o.del=u;var c=u||r;o.proxy=function(e){if(e=T(e),!e.isImmediatePropagationStopped()){e.data=s;var n=c.apply(t,e._args==i?[e]:[e].concat(e._args));return n===!1&&(e.preventDefault(),e.stopPropagation()),n}},o.i=p.length,p.push(o),"addEventListener"in t&&t.addEventListener(v(o.e),o.proxy,g(o,f))})}function x(t,e,n,i,r){var s=h(t);(e||"").split(/\s/).forEach(function(e){p(t,e,n,i).forEach(function(e){delete o[s][e.i],"removeEventListener"in t&&t.removeEventListener(v(e.e),e.proxy,g(e,r))})})}function T(t,n){if(n||!t.isDefaultPrevented){n||(n=t),e.each(j,function(e,i){var r=n[e];t[e]=function(){return this[i]=b,r&&r.apply(n,arguments)},t[i]=E});try{t.timeStamp||(t.timeStamp=Date.now())}catch(r){}(n.defaultPrevented!==i?n.defaultPrevented:"returnValue"in n?n.returnValue===!1:n.getPreventDefault&&n.getPreventDefault())&&(t.isDefaultPrevented=b)}return t}function C(t){var e,n={originalEvent:t};for(e in t)w.test(e)||t[e]===i||(n[e]=t[e]);return T(n,t)}var i,n=1,r=Array.prototype.slice,s=e.isFunction,a=function(t){return"string"==typeof t},o={},u={},f="onfocusin"in t,c={focus:"focusin",blur:"focusout"},l={mouseenter:"mouseover",mouseleave:"mouseout"};u.click=u.mousedown=u.mouseup=u.mousemove="MouseEvents",e.event={add:y,remove:x},e.proxy=function(t,n){var i=2 in arguments&&r.call(arguments,2);if(s(t)){var o=function(){return t.apply(n,i?i.concat(r.call(arguments)):arguments)};return o._zid=h(t),o}if(a(n))return i?(i.unshift(t[n],t),e.proxy.apply(null,i)):e.proxy(t[n],t);throw new TypeError("expected function")},e.fn.bind=function(t,e,n){return this.on(t,e,n)},e.fn.unbind=function(t,e){return this.off(t,e)},e.fn.one=function(t,e,n,i){return this.on(t,e,n,i,1)};var b=function(){return!0},E=function(){return!1},w=/^([A-Z]|returnValue$|layer[XY]$|webkitMovement[XY]$)/,j={preventDefault:"isDefaultPrevented",stopImmediatePropagation:"isImmediatePropagationStopped",stopPropagation:"isPropagationStopped"};e.fn.delegate=function(t,e,n){return this.on(e,t,n)},e.fn.undelegate=function(t,e,n){return this.off(e,t,n)},e.fn.live=function(t,n){return e(document.body).delegate(this.selector,t,n),this},e.fn.die=function(t,n){return e(document.body).undelegate(this.selector,t,n),this},e.fn.on=function(t,n,o,u,f){var c,l,h=this;return t&&!a(t)?(e.each(t,function(t,e){h.on(t,n,o,e,f)}),h):(a(n)||s(u)||u===!1||(u=o,o=n,n=i),(u===i||o===!1)&&(u=o,o=i),u===!1&&(u=E),h.each(function(i,s){f&&(c=function(t){return x(s,t.type,u),u.apply(this,arguments)}),n&&(l=function(t){var i,a=e(t.target).closest(n,s).get(0);return a&&a!==s?(i=e.extend(C(t),{currentTarget:a,liveFired:s}),(c||u).apply(a,[i].concat(r.call(arguments,1)))):void 0}),y(s,t,u,o,n,l||c)}))},e.fn.off=function(t,n,r){var o=this;return t&&!a(t)?(e.each(t,function(t,e){o.off(t,n,e)}),o):(a(n)||s(r)||r===!1||(r=n,n=i),r===!1&&(r=E),o.each(function(){x(this,t,r,n)}))},e.fn.trigger=function(t,n){return t=a(t)||e.isPlainObject(t)?e.Event(t):T(t),t._args=n,this.each(function(){t.type in c&&"function"==typeof this[t.type]?this[t.type]():"dispatchEvent"in this?this.dispatchEvent(t):e(this).triggerHandler(t,n)})},e.fn.triggerHandler=function(t,n){var i,r;return this.each(function(s,o){i=C(a(t)?e.Event(t):t),i._args=n,i.target=o,e.each(p(o,t.type||t),function(t,e){return r=e.proxy(i),i.isImmediatePropagationStopped()?!1:void 0})}),r},"focusin focusout focus blur load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select keydown keypress keyup error".split(" ").forEach(function(t){e.fn[t]=function(e){return 0 in arguments?this.bind(t,e):this.trigger(t)}}),e.Event=function(t,e){a(t)||(e=t,t=e.type);var n=document.createEvent(u[t]||"Events"),i=!0;if(e)for(var r in e)"bubbles"==r?i=!!e[r]:n[r]=e[r];return n.initEvent(t,i,!0),T(n)}}(e),function(e){function p(t,n,i){var r=e.Event(n);return e(t).trigger(r,i),!r.isDefaultPrevented()}function d(t,e,n,r){return t.global?p(e||i,n,r):void 0}function m(t){t.global&&0===e.active++&&d(t,null,"ajaxStart")}function g(t){t.global&&!--e.active&&d(t,null,"ajaxStop")}function v(t,e){var n=e.context;return e.beforeSend.call(n,t,e)===!1||d(e,n,"ajaxBeforeSend",[t,e])===!1?!1:void d(e,n,"ajaxSend",[t,e])}function y(t,e,n,i){var r=n.context,s="success";n.success.call(r,t,s,e),i&&i.resolveWith(r,[t,s,e]),d(n,r,"ajaxSuccess",[e,n,t]),b(s,e,n)}function x(t,e,n,i,r){var s=i.context;i.error.call(s,n,e,t),r&&r.rejectWith(s,[n,e,t]),d(i,s,"ajaxError",[n,i,t||e]),b(e,n,i)}function b(t,e,n){var i=n.context;n.complete.call(i,e,t),d(n,i,"ajaxComplete",[e,n]),g(n)}function E(t,e,n){if(n.dataFilter==w)return t;var i=n.context;return n.dataFilter.call(i,t,e)}function w(){}function j(t){return t&&(t=t.split(";",2)[0]),t&&(t==c?"html":t==f?"json":o.test(t)?"script":u.test(t)&&"xml")||"text"}function T(t,e){return""==e?t:(t+"&"+e).replace(/[&?]{1,2}/,"?")}function C(t){t.processData&&t.data&&"string"!=e.type(t.data)&&(t.data=e.param(t.data,t.traditional)),!t.data||t.type&&"GET"!=t.type.toUpperCase()&&"jsonp"!=t.dataType||(t.url=T(t.url,t.data),t.data=void 0)}function N(t,n,i,r){return e.isFunction(n)&&(r=i,i=n,n=void 0),e.isFunction(i)||(r=i,i=void 0),{url:t,data:n,success:i,dataType:r}}function O(t,n,i,r){var s,a=e.isArray(n),o=e.isPlainObject(n);e.each(n,function(n,u){s=e.type(u),r&&(n=i?r:r+"["+(o||"object"==s||"array"==s?n:"")+"]"),!r&&a?t.add(u.name,u.value):"array"==s||!i&&"object"==s?O(t,u,i,n):t.add(n,u)})}var r,s,n=+new Date,i=t.document,a=/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,o=/^(?:text|application)\/javascript/i,u=/^(?:text|application)\/xml/i,f="application/json",c="text/html",l=/^\s*$/,h=i.createElement("a");h.href=t.location.href,e.active=0,e.ajaxJSONP=function(r,s){if(!("type"in r))return e.ajax(r);var c,p,a=r.jsonpCallback,o=(e.isFunction(a)?a():a)||"Zepto"+n++,u=i.createElement("script"),f=t[o],l=function(t){e(u).triggerHandler("error",t||"abort")},h={abort:l};return s&&s.promise(h),e(u).on("load error",function(n,i){clearTimeout(p),e(u).off().remove(),"error"!=n.type&&c?y(c[0],h,r,s):x(null,i||"error",h,r,s),t[o]=f,c&&e.isFunction(f)&&f(c[0]),f=c=void 0}),v(h,r)===!1?(l("abort"),h):(t[o]=function(){c=arguments},u.src=r.url.replace(/\?(.+)=\?/,"?$1="+o),i.head.appendChild(u),r.timeout>0&&(p=setTimeout(function(){l("timeout")},r.timeout)),h)},e.ajaxSettings={type:"GET",beforeSend:w,success:w,error:w,complete:w,context:null,global:!0,xhr:function(){return new t.XMLHttpRequest},accepts:{script:"text/javascript, application/javascript, application/x-javascript",json:f,xml:"application/xml, text/xml",html:c,text:"text/plain"},crossDomain:!1,timeout:0,processData:!0,cache:!0,dataFilter:w},e.ajax=function(n){var u,f,a=e.extend({},n||{}),o=e.Deferred&&e.Deferred();for(r in e.ajaxSettings)void 0===a[r]&&(a[r]=e.ajaxSettings[r]);m(a),a.crossDomain||(u=i.createElement("a"),u.href=a.url,u.href=u.href,a.crossDomain=h.protocol+"//"+h.host!=u.protocol+"//"+u.host),a.url||(a.url=t.location.toString()),(f=a.url.indexOf("#"))>-1&&(a.url=a.url.slice(0,f)),C(a);var c=a.dataType,p=/\?.+=\?/.test(a.url);if(p&&(c="jsonp"),a.cache!==!1&&(n&&n.cache===!0||"script"!=c&&"jsonp"!=c)||(a.url=T(a.url,"_="+Date.now())),"jsonp"==c)return p||(a.url=T(a.url,a.jsonp?a.jsonp+"=?":a.jsonp===!1?"":"callback=?")),e.ajaxJSONP(a,o);var P,d=a.accepts[c],g={},b=function(t,e){g[t.toLowerCase()]=[t,e]},N=/^([\w-]+:)\/\//.test(a.url)?RegExp.$1:t.location.protocol,S=a.xhr(),O=S.setRequestHeader;if(o&&o.promise(S),a.crossDomain||b("X-Requested-With","XMLHttpRequest"),b("Accept",d||"*/*"),(d=a.mimeType||d)&&(d.indexOf(",")>-1&&(d=d.split(",",2)[0]),S.overrideMimeType&&S.overrideMimeType(d)),(a.contentType||a.contentType!==!1&&a.data&&"GET"!=a.type.toUpperCase())&&b("Content-Type",a.contentType||"application/x-www-form-urlencoded"),a.headers)for(s in a.headers)b(s,a.headers[s]);if(S.setRequestHeader=b,S.onreadystatechange=function(){if(4==S.readyState){S.onreadystatechange=w,clearTimeout(P);var t,n=!1;if(S.status>=200&&S.status<300||304==S.status||0==S.status&&"file:"==N){if(c=c||j(a.mimeType||S.getResponseHeader("content-type")),"arraybuffer"==S.responseType||"blob"==S.responseType)t=S.response;else{t=S.responseText;try{t=E(t,c,a),"script"==c?(1,eval)(t):"xml"==c?t=S.responseXML:"json"==c&&(t=l.test(t)?null:e.parseJSON(t))}catch(i){n=i}if(n)return x(n,"parsererror",S,a,o)}y(t,S,a,o)}else x(S.statusText||null,S.status?"error":"abort",S,a,o)}},v(S,a)===!1)return S.abort(),x(null,"abort",S,a,o),S;var A="async"in a?a.async:!0;if(S.open(a.type,a.url,A,a.username,a.password),a.xhrFields)for(s in a.xhrFields)S[s]=a.xhrFields[s];for(s in g)O.apply(S,g[s]);return a.timeout>0&&(P=setTimeout(function(){S.onreadystatechange=w,S.abort(),x(null,"timeout",S,a,o)},a.timeout)),S.send(a.data?a.data:null),S},e.get=function(){return e.ajax(N.apply(null,arguments))},e.post=function(){var t=N.apply(null,arguments);return t.type="POST",e.ajax(t)},e.getJSON=function(){var t=N.apply(null,arguments);return t.dataType="json",e.ajax(t)},e.fn.load=function(t,n,i){if(!this.length)return this;var o,r=this,s=t.split(/\s/),u=N(t,n,i),f=u.success;return s.length>1&&(u.url=s[0],o=s[1]),u.success=function(t){r.html(o?e("<div>").html(t.replace(a,"")).find(o):t),f&&f.apply(r,arguments)},e.ajax(u),this};var S=encodeURIComponent;e.param=function(t,n){var i=[];return i.add=function(t,n){e.isFunction(n)&&(n=n()),null==n&&(n=""),this.push(S(t)+"="+S(n))},O(i,t,n),i.join("&").replace(/%20/g,"+")}}(e),function(t){t.fn.serializeArray=function(){var e,n,i=[],r=function(t){return t.forEach?t.forEach(r):void i.push({name:e,value:t})};return this[0]&&t.each(this[0].elements,function(i,s){n=s.type,e=s.name,e&&"fieldset"!=s.nodeName.toLowerCase()&&!s.disabled&&"submit"!=n&&"reset"!=n&&"button"!=n&&"file"!=n&&("radio"!=n&&"checkbox"!=n||s.checked)&&r(t(s).val())}),i},t.fn.serialize=function(){var t=[];return this.serializeArray().forEach(function(e){t.push(encodeURIComponent(e.name)+"="+encodeURIComponent(e.value))}),t.join("&")},t.fn.submit=function(e){if(0 in arguments)this.bind("submit",e);else if(this.length){var n=t.Event("submit");this.eq(0).trigger(n),n.isDefaultPrevented()||this.get(0).submit()}return this}}(e),function(){try{getComputedStyle(void 0)}catch(e){var n=getComputedStyle;t.getComputedStyle=function(t,e){try{return n(t,e)}catch(i){return null}}}}(),function(t,e){function v(t){return t.replace(/([A-Z])/g,"-$1").toLowerCase()}function y(t){return i?i+t:t.toLowerCase()}var i,o,u,f,c,l,h,p,d,m,n="",r={Webkit:"webkit",Moz:"",O:"o"},s=document.createElement("div"),a=/^((translate|rotate|scale)(X|Y|Z|3d)?|matrix(3d)?|perspective|skew(X|Y)?)$/i,g={};s.style.transform===e&&t.each(r,function(t,r){return s.style[t+"TransitionProperty"]!==e?(n="-"+t.toLowerCase()+"-",i=r,!1):void 0}),o=n+"transform",g[u=n+"transition-property"]=g[f=n+"transition-duration"]=g[l=n+"transition-delay"]=g[c=n+"transition-timing-function"]=g[h=n+"animation-name"]=g[p=n+"animation-duration"]=g[m=n+"animation-delay"]=g[d=n+"animation-timing-function"]="",t.fx={off:i===e&&s.style.transitionProperty===e,speeds:{_default:400,fast:200,slow:600},cssPrefix:n,transitionEnd:y("TransitionEnd"),animationEnd:y("AnimationEnd")},t.fn.animate=function(n,i,r,s,a){return t.isFunction(i)&&(s=i,r=e,i=e),t.isFunction(r)&&(s=r,r=e),t.isPlainObject(i)&&(r=i.easing,s=i.complete,a=i.delay,i=i.duration),i&&(i=("number"==typeof i?i:t.fx.speeds[i]||t.fx.speeds._default)/1e3),a&&(a=parseFloat(a)/1e3),this.anim(n,i,r,s,a)},t.fn.anim=function(n,i,r,s,y){var x,E,T,b={},w="",j=this,C=t.fx.transitionEnd,N=!1;if(i===e&&(i=t.fx.speeds._default/1e3),y===e&&(y=0),t.fx.off&&(i=0),"string"==typeof n)b[h]=n,b[p]=i+"s",b[m]=y+"s",b[d]=r||"linear",C=t.fx.animationEnd;else{E=[];for(x in n)a.test(x)?w+=x+"("+n[x]+") ":(b[x]=n[x],E.push(v(x)));w&&(b[o]=w,E.push(o)),i>0&&"object"==typeof n&&(b[u]=E.join(", "),b[f]=i+"s",b[l]=y+"s",b[c]=r||"linear")}return T=function(e){if("undefined"!=typeof e){if(e.target!==e.currentTarget)return;t(e.target).unbind(C,T)}else t(this).unbind(C,T);N=!0,t(this).css(g),s&&s.call(this)},i>0&&(this.bind(C,T),setTimeout(function(){N||T.call(j)},1e3*(i+y)+25)),this.size()&&this.get(0).clientLeft,this.css(b),0>=i&&setTimeout(function(){j.each(function(){T.call(this)})},0),this},s=null}(e),function(e,n){function u(t,i,r,s,a){"function"!=typeof i||a||(a=i,i=n);var o={opacity:r};return s&&(o.scale=s,t.css(e.fx.cssPrefix+"transform-origin","0 0")),t.animate(o,i,null,a)}function f(t,n,i,r){return u(t,n,0,i,function(){a.call(e(this)),r&&r.call(this)})}var i=t.document,s=(i.documentElement,e.fn.show),a=e.fn.hide,o=e.fn.toggle;e.fn.show=function(t,e){return s.call(this),t===n?t=0:this.css("opacity",0),u(this,t,1,"1,1",e)},e.fn.hide=function(t,e){return t===n?a.call(this):f(this,t,"0,0",e)},e.fn.toggle=function(t,i){return t===n||"boolean"==typeof t?o.call(this,t):this.each(function(){var n=e(this);n["none"==n.css("display")?"show":"hide"](t,i)})},e.fn.fadeTo=function(t,e,n){return u(this,t,e,null,n)},e.fn.fadeIn=function(t,e){var n=this.css("opacity");return n>0?this.css("opacity",0):n=1,s.call(this).fadeTo(t,n,e)},e.fn.fadeOut=function(t,e){return f(this,t,null,e)},e.fn.fadeToggle=function(t,n){return this.each(function(){var i=e(this);i[0==i.css("opacity")||"none"==i.css("display")?"fadeIn":"fadeOut"](t,n)})}}(e),function(t){function a(s,a){var u=s[r],f=u&&e[u];if(void 0===a)return f||o(s);if(f){if(a in f)return f[a];var c=i(a);if(c in f)return f[c]}return n.call(t(s),a)}function o(n,s,a){var o=n[r]||(n[r]=++t.uuid),f=e[o]||(e[o]=u(n));return void 0!==s&&(f[i(s)]=a),f}function u(e){var n={};return t.each(e.attributes||s,function(e,r){0==r.name.indexOf("data-")&&(n[i(r.name.replace("data-",""))]=t.zepto.deserializeValue(r.value))}),n}var e={},n=t.fn.data,i=t.camelCase,r=t.expando="Zepto"+ +new Date,s=[];t.fn.data=function(e,n){return void 0===n?t.isPlainObject(e)?this.each(function(n,i){t.each(e,function(t,e){o(i,t,e)})}):0 in this?a(this[0],e):void 0:this.each(function(){o(this,e,n)})},t.data=function(e,n,i){return t(e).data(n,i)},t.hasData=function(n){var i=n[r],s=i&&e[i];return s?!t.isEmptyObject(s):!1},t.fn.removeData=function(n){return"string"==typeof n&&(n=n.split(/\s+/)),this.each(function(){var s=this[r],a=s&&e[s];a&&t.each(n||a,function(t){delete a[n?i(this):t]})})},["remove","empty"].forEach(function(e){var n=t.fn[e];t.fn[e]=function(){var t=this.find("*");return"remove"===e&&(t=t.add(this)),t.removeData(),n.call(this)}})}(e),function(t){t.Callbacks=function(e){e=t.extend({},e);var n,i,r,s,a,o,u=[],f=!e.once&&[],c=function(t){for(n=e.memory&&t,i=!0,o=s||0,s=0,a=u.length,r=!0;u&&a>o;++o)if(u[o].apply(t[0],t[1])===!1&&e.stopOnFalse){n=!1;break}r=!1,u&&(f?f.length&&c(f.shift()):n?u.length=0:l.disable())},l={add:function(){if(u){var i=u.length,o=function(n){t.each(n,function(t,n){"function"==typeof n?e.unique&&l.has(n)||u.push(n):n&&n.length&&"string"!=typeof n&&o(n)})};o(arguments),r?a=u.length:n&&(s=i,c(n))}return this},remove:function(){return u&&t.each(arguments,function(e,n){for(var i;(i=t.inArray(n,u,i))>-1;)u.splice(i,1),r&&(a>=i&&--a,o>=i&&--o)}),this},has:function(e){return!(!u||!(e?t.inArray(e,u)>-1:u.length))},empty:function(){return a=u.length=0,this},disable:function(){return u=f=n=void 0,this},disabled:function(){return!u},lock:function(){return f=void 0,n||l.disable(),this},locked:function(){return!f},fireWith:function(t,e){return!u||i&&!f||(e=e||[],e=[t,e.slice?e.slice():e],r?f.push(e):c(e)),this},fire:function(){return l.fireWith(this,arguments)},fired:function(){return!!i}};return l}}(e),function(t){function r(e){return e=t(e),!(!e.width()&&!e.height())&&"none"!==e.css("display")}function f(t,e){t=t.replace(/=#\]/g,'="#"]');var n,i,r=a.exec(t);if(r&&r[2]in s&&(n=s[r[2]],i=r[3],t=r[1],i)){var o=Number(i);i=isNaN(o)?i.replace(/^["']|["']$/g,""):o}return e(t,n,i)}var e=t.zepto,n=e.qsa,i=e.matches,s=t.expr[":"]={visible:function(){return r(this)?this:void 0},hidden:function(){return r(this)?void 0:this},selected:function(){return this.selected?this:void 0;
},checked:function(){return this.checked?this:void 0},parent:function(){return this.parentNode},first:function(t){return 0===t?this:void 0},last:function(t,e){return t===e.length-1?this:void 0},eq:function(t,e,n){return t===n?this:void 0},contains:function(e,n,i){return t(this).text().indexOf(i)>-1?this:void 0},has:function(t,n,i){return e.qsa(this,i).length?this:void 0}},a=new RegExp("(.*):(\\w+)(?:\\(([^)]+)\\))?$\\s*"),o=/^\s*>/,u="Zepto"+ +new Date;e.qsa=function(i,r){return f(r,function(s,a,f){try{var c;!s&&a?s="*":o.test(s)&&(c=t(i).addClass(u),s="."+u+" "+s);var l=n(i,s)}catch(h){throw console.error("error performing selector: %o",r),h}finally{c&&c.removeClass(u)}return a?e.uniq(t.map(l,function(t,e){return a.call(t,e,l,f)})):l})},e.matches=function(t,e){return f(e,function(e,n,r){return(!e||i(t,e))&&(!n||n.call(t,null,r)===t)})}}(e),e});try {
    var Statistics = {
        uuid  : '',
        params: {
            ctime       : '', //日志生成时间
            sid         : '', //当前会话id
            uuid         : '', //浏览器唯一用户标识
            guid        : '', //统一用户id
            ip          : '',
            sh          : '',
            sw          : '',
            ua          : '',
            appid       : '',
            areaid      : '',
            title       : '',
            url         : '',
            ref         : '',
            path        : 'tymlog',
            cname       : 'TYlogin',
            event_type  : 'P',
            eid         : '',
            e1          : '',
            e2          : '',
            pid         : '',
            x           : '',
            y           : ''
        },
        eventIds: {
            qq          : {eid:'ty_A04',pid:'ty_P_login'},
            weixin      : {eid:'ty_A01',pid:'ty_P_login'},
            alipay      : {eid:'ty_A02',pid:'ty_P_login'},
            sina        : {eid:'ty_A05',pid:'ty_P_login'},
            baidu       : {eid:'ty_A03',pid:'ty_P_login'},
            jumpaq      : {eid:'ty_A06',pid:'ty_P_login'}
        },
        pageIds: {
            loginShow       : 'ty_P_login',
            readXShow       : 'ty_P_zylogin',
            qqShow          : 'ty_P_qqlogin',
            weixinShow      : 'ty_P_wxlogin',
            phoneShow       : 'ty_P_phsec',
            readXPhoneShow  : 'ty_P_zyphsec',
            riskShow        : 'ty_P_hirsk',
            loginSuc        : 'ty_P_login_suc',
            phoneSuc        : 'ty_P_phsec_suc',
            readXphoneSuc   : 'ty_P_zyphsec_suc',
            qqSuc           : 'ty_P_qqlogin_suc',
            weixinSuc       : 'ty_P_wxlogin_suc',
            alipaySuc       : 'ty_P_landzfblogin_suc',
            sinaSuc         : 'ty_P_wblogin_suc',
            baiduSuc        : 'ty_P_bdlogin_suc'
        },

        init: function(data) {
            if(data == 'undefined' || data == null){
                data = {appid:'',areaid:'',userip:'',uuid:''};
            }

            Statistics.uuid = data.uuid;
            Statistics.commonParams(data);

            Statistics.curPage();

            $('#j-otherWay .alipay').on('click', function(e) {
                Statistics.clickParams(e,'alipay');
            });

            $('#j-otherWay .sina').on('click', function(e) {
                Statistics.clickParams(e,'sina');
            });

            $('#j-otherWay .baidu').on('click', function(e) {
                Statistics.clickParams(e,'baidu');
            });

            $('#j-otherLogin li a').on('click', function(e) {
                if($(this).find('em').hasClass('qq')){
                    Statistics.clickParams(e,'qq');
                }else if($(this).find('em').hasClass('wechat')){
                    Statistics.clickParams(e,'weixin');
                }else if($(this).find('em').hasClass('sms')){
                    if($('.tab-wrap span').length > 0 && $('.tab-wrap span.act').text() != '阅文通行证'){
                        Statistics.showParams('readXPhoneShow');
                    }else{
                        Statistics.showParams('phoneShow');
                    }
                }
            });

            $('.tab-wrap span').on('click', function(e) {
                if($(this).text() != '阅文通行证'){
                    Statistics.showParams('readXShow');
                }else{
                    Statistics.showParams('loginShow');
                }
            });

            //高危跳安全中心
            $('#jumpAq').on('click', function(e) {
                Statistics.clickParams(e,'jumpaq');
            });

        },

        clickParams: function(e,name) {
            Statistics.params.x = e.pageX;
            Statistics.params.y = e.pageY;
            Statistics.params.event_type = 'A';
            Statistics.params.eid = Statistics.eventIds[name].eid;
            Statistics.params.pid = Statistics.eventIds[name].pid;
            Statistics.send();
        },

        showParams: function(name){
            Statistics.params.x = '';
            Statistics.params.y = '';
            Statistics.params.event_type = 'P';
            Statistics.params.eid = '';
            Statistics.params.pid = Statistics.pageIds[name];
            Statistics.send();
        },

        commonParams: function(data) {
            Statistics.params.sh = window.screen.height;
            Statistics.params.sw = window.screen.width;
            Statistics.params.ua = navigator.userAgent;
            Statistics.params.title = document.title;
            Statistics.params.url = encodeURIComponent(window.location.href);
            Statistics.params.ref = encodeURIComponent(document.referrer);
            Statistics.params.appid = data.appid;
            Statistics.params.areaid = data.areaid;
            Statistics.params.ip = data.userip;
        },

        curPage: function(){
            if($('.login-wrap').length == 0) return false;
            if($('.tab-wrap span').length != 0 && $('.tab-wrap span.act').text() != '阅文通行证'){
                Statistics.showParams('readXShow');
            }else{
                Statistics.showParams('loginShow');
            }
        },

        loginSuc: function(name){
            if(name == 'qq'){
                Statistics.showParams('qqSuc');
            }else if(name == 'weixin'){
                Statistics.showParams('weixinSuc');
            }else if(name == 'alipay'){
                Statistics.showParams('alipaySuc');
            }else if(name == 'baidu'){
                Statistics.showParams('baiduSuc');
            }else if(name == 'sina'){
                Statistics.showParams('sinaSuc');
            }else if(name == 'risk'){
                Statistics.showParams('riskShow');
            }else if(name == 'phonelogin'){
                Statistics.showParams('phoneSuc');//手机
            }else if(name == 'login'){
                Statistics.showParams('loginSuc');//账号密码
            }
        },

        getUniqueId: function(name,days){
            var uniqueId = Statistics.getCookie(name);
            if(uniqueId != 'undefined' && uniqueId != null && uniqueId != '') return uniqueId;

            uniqueId = Statistics.uuid;
            Statistics.setCookie(name,uniqueId,days);
            return uniqueId;
        },

        getDate: function(){
            var date = new Date();
            var year = date.getFullYear();
            var month = date.getMonth()+1;
            if(month < 10) month = '0'+month;
            var day = date.getDate();
            if(day < 10) day = '0'+day;
            var hour = date.getHours();
            if(hour < 10) hour = '0'+hour;
            var minute = date.getMinutes();
            if(minute < 10) minute = '0'+minute;
            var second = date.getSeconds();
            if(second < 10) second = '0'+second;
            return year+'-'+month+'-'+day+' '+hour+':'+minute+':'+second;
        },

        getCookie: function(name){
            var arr,reg=new RegExp("(^| )"+name+"=([^;]*)(;|$)");
            if(arr=document.cookie.match(reg))  return unescape(arr[2]);
            else return '';
        },

        setCookie: function(name,value,days){
            var exp = new Date();
            var host = window.location.host;
            exp.setTime(exp.getTime() + days*24*60*60*1000);
            var str = name + "="+ escape (value);
            if(host.indexOf('yuewen.com') > 0) str += ';domain=.yuewen.com';
            else if(host.indexOf('qidian.com') > 0 && name == 'newstatisticUUID') str+= ';domain=.qidian.com;path=/';
            if(days > 0) str += ";expires=" + exp.toGMTString();
            document.cookie = str;
        },

        send: function() {
            var url = 'https://path.book.qq.com/unifyreport?';
            Statistics.params.ctime = Statistics.getDate();
            Statistics.params.guid = Statistics.getCookie('ywguid');
            Statistics.params.sid = Statistics.getUniqueId('newstatisticSID',0);
            Statistics.params.uuid = Statistics.getUniqueId('newstatisticUUID',365);
            $.each(Statistics.params, function(k, v){
                url += k+'='+v+'&';
            });

            url = url .substring(0,url.length - 1);

            $.ajax({
                type: "get",
                url: url,
                data: {},
                dataType: "jsonp",
                success: function() {},
                error: function(xhr, status, err) {},
                timeout: 3000
            });
        }
    };
    
    function OK(){}
} catch (e) {}
var LoginV1 = {
    config:  {
        code         : -1,
        domain       : 'qidian.com',
        message      : '',
		appId        : 0,
        areaId       : 0,
        format       : 'json',
        method       : '', // jsonp方式下执行的函数
        autoTime     : 14,
        autoShow     : '',
        target       : '',
        returnUrl    : '',
        source       : '',
        version      : '',
        imei         : '',
        qimei        : '',
        unionShow    : '',
        loginfrom    : '',
        ticket       : 0,
        tab          : 'qidian', // 默认展现起点tab，可选qq 和 weixin
        popup        : 0, // 是否是弹窗 
        baseUrl      : '',
        qqBaseUrl    : '',
        cssPath      : 'https://passport.qidian.com',
        loginPostfix : '',
        sdkversion   : '',
        modulus      : '',
        exponent     : '',
        aqurl        : '',
        ywtoken      : '',
        nativeLogin  : '',
        closeLogin   : '',
        scanMethod   : ''
	},


    safeData: {},
    validateSrc     : '',
    currentType     : 0, //当前的登录方式: 0静态密码登录、1图片验证码、6自动登录、9二维码登录
    sessionKey      : '',
    helpTip         : '',
    codeKey         : '',
    nextAction      : 0,
    isLogin         : false,
    ajaxLock        : false,
    qrCodeCheckTime : 0, // 二维码检测次数
    qrCodeCheckInterval: 1000, // 二维码检测间隔
    qrCodeCheckTimeMax : 10, // 二维码检测最大次数
    loginClock      : '',
    loginTimeout    : '',
    countDownTimeout: '',
    loginInvalid    : !1,
    thirdLogin      : ['alipay', 'weibo', 'baidu', 'qqconnect'],
    thirdLoginShow  : 0,

    captchaObj      : '',
    captchaType     : 0,
    captchaAppId    : "1600000770",
    
    lightTip        : '<section class="light-tip" style="opacity:0;"><p></p></section>',
    
    weixinWrapIframe: $('#div_weixinlogin'),
    qqWrapIframe    : $('#div_qqlogin'),
    weixinWrapUrl   : '/login/weixinlogin',
    qqWrapUrl       : '/qqptlogin.html',
    qqWtUrl         : 'https://ui.ptlogin2.qq.com/cgi-bin/login?style=9&appid=780038201&daid=0&pt_no_onekey=0&low_login=0&s_url=',
    isCloseNove     : false, //是否关闭小悦弹窗
    
    ajaxUrls: {
        'staticLogin'   : '/login/login',
        'checkCodeLogin': '/login/checkcode',
        'autoLogin'     : '/login/autologin',
        'updateCode'    : '/login/updatecode',
        'ssoLogin'      : '/login/ssologin',
        'validateTicket': '/login/validate',
        'checkStatus'   : '/login/checkStatus',
        'getCaptcha'    : '/user/getvalidatecode',
        'getCaptchaNew' : '/userSdk/getvalidatecodenew',
        'phoneSendMsg'  : '/userSdk/sendmsgnew',
        'phoneCodeLogin': '/userSdk/phonecodelogin',
        'qrCode'        : '/login/qrcode',
        'qrCodeLogin'   : '/login/qrcodelogin',
        'relateQRCode'  : '/login/relateqrcode',
        'qqCallbackUrl' : '/login/qqptcallback',
        'logout'        : '/login/logout',
        'sendPhoneVerifyCode' : '/login/sendphonemsg',
        'phoneCodeVerify'     : '/login/phonekeycodelogin',
        'cancleScanLogin' : '/login/cancleLogin'
    },
    
    errors: {
        '-11003'   : '验证码超时',
        '-11020'   : '您输入的账号或密码不正确，请重新输入',
        '-11016'   : '您输入的账号或密码不正确，请重新输入',
        '-10503'   : '验证码不能为空',
        '-1'       : '登录失败，请稍后重试'
    },
    
    // 初始化一些登录时间，检测二维码等
    beginLogin: function() {
        LoginV1.loginInvalid = !1;
    },
    
    init: function(params) {
        LoginV1.setParams(params);
        LoginV1.initRsaEncrypt();
        
        var domain = LoginV1.config.domain || 'qidian.com';
        domain = domain.split('.');
        var length = domain.length;
        if (length >= 2) {
            domain = domain[length - 2] + '.' + domain[length - 1];
            document.domain = domain;
        } else {
            document.domain = 'qidian.com';
        }
        
        if (LoginV1.getCookie('hightip') === "1") {
            $('.noNeedWarnTip').attr('checked', 'checked');
        }
        
        // 检查是否已经登录
        // 检查是否选中自动登录
        // 查看登录模式，是否是qq登录
        LoginV1.beginLogin();
        $('#j-delPassWord').hide();
        
        $('#j-delPassWord').on('click', function () {
            $(this).prev().val('');
            $('.login-button').addClass('disabled');
        });
        $('#j-switchBtn').on('click', function () {
            if ( LoginV1.thirdLoginShow == 0 ) {
                //第一次点击时箭头变上，展开其他登录方式，父级容器上移
                $('.icon-arrow-down').addClass('up');
                $('#j-otherWay').animate({
                    height: '0.36rem',
                    opacity: 1
                }, 'fast').addClass('on');
                $('#j-otherLogin').addClass('up');
                LoginV1.thirdLoginShow = 1;
                $('#j-switchBtn').attr('data-report', '1'); // 此处标志是否需要上报，由于该事件在stat.click事件之前，所以值为相反的
                
            } else {
                //非第一次点击时箭头变下，收起其他登录方式，父级容器下移
                $('.icon-arrow-down').removeClass('up');
                $('#j-otherWay').animate({
                    height: '0',
                    opacity: 0
                }, 'fast').removeClass('on');
                $('#j-otherLogin').removeClass('up');
                LoginV1.thirdLoginShow = 0;
                $('#j-switchBtn').attr('data-report', '0'); // 此处标志是否需要上报，由于该事件在stat.click事件之前，所以值为相反的
            }
        });
        $('#j-passWordOff').on('click', function () {
            $('#password').attr('type', 'text');
            $('#j-passWordOff').hide();
            $('#j-passWordOn').show();
        });
        $('#j-passWordOn').on('click', function () {
            $('#password').attr('type', 'password');
            $('#j-passWordOff').show();
            $('#j-passWordOn').hide();
        });
        
        if (LoginV1.checkStatus() == true) {
            return;
        }
        
        $('input').on('keyup', function(e) {
            LoginV1.hideError();
            if($("#j-accountLoginWrap").is(":visible")){
                if (LoginV1.checkForm()) $('.login-button').removeClass('disabled');
                else $('.login-button').addClass('disabled');
            }else if($("#j-phoneLoginWrap").is(":visible")){
                var phoneCheck = LoginV1.checkPhoneForm();
                if (phoneCheck) {
                    // 如果按钮中含有数字，则不允许改变状态
                    if (/(\(\d+\))/i.test($('#sendPhoneMsg').text()) != true)
                        $('#sendPhoneMsg').removeClass('disabled');
                } else $('#sendPhoneMsg').addClass('disabled');
                
                if(phoneCheck && $.trim($('#phonecode').val()).length > 0) $('.phoneBtnLogin').removeClass('disabled');
                else $('.phoneBtnLogin').addClass('disabled');
            }
        });
        
        $('input').on('focus', function(e) {
            //$(this).parent().removeClass('error');
            setTimeout(function(){
                $('.top-img').hide();
                $('.logo-img').hide();
            }, 100);
        });
        
        $('#password').on('keyup', function() {
            var val = $(this).val().trim();
            if (val != '') {
                $('#j-delPassWord').show();
            } else {
                $('#j-delPassWord').hide();
            }
        }).on('focus', function() {
            var val = $(this).val().trim();
            if (val != '') {
                $('#j-delPassWord').show();
            } else {
                $('#j-delPassWord').hide();
            }
        }).on('blur', function() {
            setTimeout(function() { $('#j-delPassWord').hide(); }, 100);
        });
        
        $('.login-button').on('click', function() {
            if (LoginV1.checkForm()) {
                LoginV1.login();
            }
        });
        
        $('body').on('click', function() {
            LoginV1.hideError();
        });
        
        $('.phoneBtnLogin').on('click', function(e) {
            if (LoginV1.checkPhoneForm()) {
                LoginV1.phoneCodeLogin();
            }
        });
        
        $('#imgCode').on('click', function() {
            LoginV1.refreshCode();
        });
        $('#btnRefreshCode').on('click', function() {
            LoginV1.refreshCode();
        });
        
        //新版开始
        //展开更多登录方式
        $('#j-moreLogin').on('click', function () {
            $('#j-moreLoginWrap').addClass('show')
        });

        //收起更多登录方式
        $('#j-hideMoreLogin').on('click', function () {
            $('#j-moreLoginWrap').removeClass('show')
        });

        //切换到通行证登录
        $('#j-passportLogin').on('click', function () {
            $('#j-phoneLoginWrap').hide();
            $('#j-accountLoginWrap').show();
            $('#j-smsLogin').css('display','inline-block');
            $('#j-passportLogin').hide();
        });


        //切换到短信登录
        $('#j-smsLogin').on('click', function () {
            $('#j-phoneLoginWrap').show();
            $('#j-accountLoginWrap').hide();
            $('#j-smsLogin').hide();
            $('#j-passportLogin').css('display','inline-block');
        });
        //切换账号

        $('#j-loginTab').on('click', 'span', function () {
            $(this).addClass('act').siblings().removeClass();
        });
        
        $('#phonearea').on('click', function () {
            $(".wrapper").animate(
            {
                opacity:0.7,
                translateX:'-100%'
            },
            200,
            'ease-out',
            function() {
                $(".wrapper").hide();
                $("#section_phone_area").show();
                $('.letter').show();
            });
        });


        //清空密码
        var delPassWord = function () {
            var delPassWord = $('#j-delPassWord');
            delPassWord.on('touchstart', function () {
                $(this).prev().val('');
            })
        };
        delPassWord();

        /**$('.jumpAccountLogin').on('click', function (e) {
            var url = window.location.href;
            if(url.indexOf('?') > 0) url += '&logintype=1&thirdlogin=1';
            else url += '?logintype=1&thirdlogin=1';
            location.href = url;
        });*/
        
        $('.jumpPhoneLogin').on('click', function (e) {
            var url = window.location.href;
            if(url.indexOf('?') > 0) url += '&logintype=2&unionShow=0';
            else url += '?logintype=2&unionShow=0';
            location.href = url;
        });

        //密码切换成可见
        $('#j-isLook').on('click', function (e) {
            var target = $(e.currentTarget);

            var eyeIcon = target.find('i');
            if (eyeIcon.hasClass('unlook')) {
                eyeIcon.addClass('look');
                eyeIcon.removeClass('unlook');
                $('#password').attr('type', 'text');
            } else {
                eyeIcon.addClass('unlook');
                eyeIcon.removeClass('look');
                $('#password').attr('type', 'password');
            }
        });
        
        $('#sendPhoneMsg').on('click', function(e) {
            if($('#sendPhoneMsg').hasClass('disabled')) return false;
            if ($("#phonemobile").val().trim().length > 0) {
                if(LoginV1.codeKey && !$('#img-code-input').is(':hidden') && $.trim($("#txtCode").val()).length <= 0){
                    LoginV1.showError('请填写验证码');
                    return;
                }
                LoginV1.phoneSendMsg();
            }
        });


        $('#phonemobile').on('change', function () {
            LoginV1.sessionKey = '';
        });


        $('body')
            .on('touchstart', function(e) {
                LoginV1.startX = e.targetTouches[0].clientX;
                LoginV1.startY = e.targetTouches[0].clientY;
            })
            .on('touchmove', function(e) {
                if (e.targetTouches[0].clientY - LoginV1.startY > 20) {
                    // 下拉
                    LoginV1.showTopImage();
                }
            })
        $('.login-wrap').on('click', function(e) {
            if (e.toElement.id == 'otherLogin') return;
            if ($('#j-moreLoginWrap').attr('class').indexOf('show') > -1) {
                $('#j-moreLoginWrap').removeClass('show'); 
            }
        });
        //新版结束
        // ubook 登录事件
        $('.ubookLogin').on('click', function() {
            if (LoginV1.checkForm()) {
                $('#message').removeClass('active');
                LoginV1.login('LoginV1.loginUbookCallback');
            }
        });
        $('#dvCode .cancle').on('click', function() {
            $('#dvCode').removeClass('active');
            LoginV1.nextAction = 0;
            LoginV1.codeKey = '';
            $('#txtCode').val('');
            $('.ubookLogin').eq(0).addClass('active');
            $('.ubookLogin').eq(1).removeClass('active');
        });
        $('.ubookTxt').on('keyup', function() {
            if (LoginV1.checkForm()) {
                if (LoginV1.nextAction == 0) {
                    $('.ubookLogin').eq(0).addClass('active');
                } else {
                    $('#dvCode .sub').addClass('active');
                }
            } else {
                if (LoginV1.nextAction == 0) {
                    $('.ubookLogin').eq(0).removeClass('active');
                } else {
                    $('#dvCode .sub').removeClass('active');
                }
            }
        });
        //$('#username').focus();
        
        window.onhashchange = function() {
            if (window.location.hash == "#dvCode") {
                $('#dvCode').addClass('active');
                LoginV1.nextAction = 8;
            } else {
                $('#dvCode').removeClass('active');
                LoginV1.nextAction = 0;
            }
        };
        
        // 小阅和阅文账号切换
        $('.tab-wrap span').on('click', function() {
        	if($(this).hasClass('act')) 
        		return ;
        	
            $('.act').removeClass('act');
            $(this).addClass('act');

            LoginV1.setCookie('ywtab', $(this).attr('tab'), (new Date()).AddDays(30), '/');
        });
        
    },

    showTopImage: function() {
        $('.top-img').show();
        $('.logo-img').show();
    },

    initRsaEncrypt: function() {
        var rsaurl = LoginV1.config.cssPath + '/rsa/rsa_encrypt.js';
        LoginV1.getScript(rsaurl, function() {

        });
    },
    
    initScanPage: function(params) {
        LoginV1.setParams(params);

        if(LoginV1.config.isLogin && (LoginV1.config.isQQ || LoginV1.config.isWeixin)){
            LoginV1.relateQRCode();
        }
        
        //确认登录
        $('#scanLogin').on('click', function () {
            LoginV1.relateQRCode();
        });
        $('#login').on('click', function () {
            // 呼出端的登录
            LoginV1.qrReaderLogin();
        });
        //取消登录 关闭页面
        $('#cancelScanLogin').on('click', function () {
            LoginV1.cancelScanLogin('close');
        });
        
        $('#reloadScanLogin').on('click', function () {
            LoginV1.cancelScanLogin('reload');
        });
        
        if (!LoginV1.config.isLogin) {
            $('#scanLogin').hide();
            $("#cancelScanLogin").hide();
            $('#login').show();
            $(".site-img").addClass('error');
            $('.site-img p').html('您尚未登录客户端，请登录后再试');
        }
    },
    
    cancelScanLogin: function(type) {
        // 请求ajax获取二维码
        var data = LoginV1.buildBaseData();
        data.qrcode = LoginV1.config.qrcode 
        data.method = (type != undefined && type == 'reload') ? 'LoginV1.cancleReloadCallback' : 'LoginV1.cancleCloseCallback';
        if(data.qrcode != undefined && data.qrcode != ''){
            data.qrcode = LoginV1.config.scanCode;
            LoginV1.jsonp(LoginV1.config.baseUrl + LoginV1.ajaxUrls.cancleScanLogin, data);
        }else{
            LoginV1.cancleCallback();
        }
    },
    cancleReloadCallback:function(){
        var scanMethod = LoginV1.config.scanMethod;
        location.href = scanMethod != undefined && scanMethod != '' ? scanMethod : LoginV1.config.closeLogin ;
    },
    
    cancleCloseCallback:function(){
        location.href = LoginV1.config.closeLogin ;
    },
    
    isIos: function() {
        var b = /(iPhone|iPad|iPod|iOS)/i.test(navigator.userAgent);
        return b;
    },
    isNewQDReader: function() {
        if (typeof QidianPlugin !== "undefined" && typeof QidianPlugin.GetVersionCode == "function") {
            if (QidianPlugin.GetVersionCode() >= 200) {
                return true;
            }
        }
        return false;
    },
    qrReaderLogin: function() {
        if (typeof (LoginV1.config.nativeLogin) != "undefined" && LoginV1.config.nativeLogin!='') {
            location.href = LoginV1.config.nativeLogin;
        } else {
            location.href = LoginV1.config.staticBaseUrl + "/mobile/login.html?appId="+LoginV1.config.appId + '&areaId='+LoginV1.config.areaId;
        }
    },
    
    staticLogin: function() {
        LoginV1.currentType = 0;
        LoginV1.hideError();
        $('#j_scanLoginBtn').text('起点扫码登录');
        $('#j_normalLogin').show();
        $('#j_scanLogin').hide();
    },
    
    qrCode: function() {
        LoginV1.currentType = 9;
        LoginV1.hideError();
        $('#j_scanLoginBtn').text('账号密码登录');
        $('#j_normalLogin').hide();
        $('#j_scanLogin').show();
        
        if($(".qrcodeNotice").length > 0){
            $(".qrcodeNotice").addClass('hidden');
            $(".qrcodeNotice .reload").addClass('hidden');
            $(".qrcodeNotice .scanSuccess").addClass('hidden');
        }
        LoginV1.getQrCode();
    },
    
    getQrCode: function() {
        LoginV1.qrCodeCheckTime = 0;
        // 请求ajax获取二维码
        var data = LoginV1.buildBaseData();
        data.qrcode = LoginV1.config.qrcode 
            data.method = 'LoginV1.qrCodeCallback';
        
        LoginV1.hideError();
        
        LoginV1.jsonp(LoginV1.config.baseUrl + LoginV1.ajaxUrls.qrCode, data);
        // 增加time事件，检查是否扫描成功
        // 在切换至其他登录方式时，删除该事件
    },
    
    qrCodeCallback: function(data) {
        if (data && data.code == 0 && data.data) {
            $('#imgQrCode').attr('src', data.data.image);
            LoginV1.sessionKey = data.data.sessionKey;
            
            setTimeout(function() {LoginV1.qrCodeLogin();}, 3000);
        } else {
            LoginV1.showError(data.message || LoginV1.errors[-1]);
        }
    },
    
    qrCodeLogin: function() {
        if (LoginV1.currentType != 9) {
            return;
        }
        
        var data = LoginV1.buildBaseData();
            data.method = 'LoginV1.qrCodeLoginCallback';
            data.qrcode = LoginV1.sessionKey;
        LoginV1.jsonp(LoginV1.config.baseUrl + LoginV1.ajaxUrls.qrCodeLogin, data);
    },
    
    qrCodeLoginCallback: function(data) {
        if (LoginV1.qrCodeCheckTime >= LoginV1.qrCodeCheckTimeMax) {
            // 超过次数不再检测二维码
            LoginV1.showError('超时了 请点击刷新');
            return;
        }
        LoginV1.qrCodeCheckTime++;
        if (data && data.code == 0 && data.data) {
            LoginV1.loginSuccess(data.data);
        } else {
            setTimeout(function() {
                LoginV1.qrCodeLogin();
            }, LoginV1.qrCodeCheckInterval);
        }
    },

    phoneSendMsg: function() {
        LoginV1.hideError();

        if (LoginV1.ajaxLock) return false;

        var data = LoginV1.buildBaseData();
        var areaId = $.trim($('#phonearea').text());
        var mobilePhone = $.trim($('#phonemobile').val());
        var validateCode = $.trim($('#txtCode').val());
        data.phoneIsAbroad = areaId == '+86' ? 0 : 1;
        data.auto = LoginV1.getCookie('al') || '',
            data.inputUserId = areaId+mobilePhone,
            data.sessionKey = LoginV1.codeKey,
            data.type = 1,
            data.validateCode = validateCode,
            data.needRegister = LoginV1.config.needRegister || 0,
            data.method = 'LoginV1.phoneSendMsgCallback';

        LoginV1.ajaxLock = true;
        $('#sendPhoneMsg').addClass('disabled');

        LoginV1.jsonp(LoginV1.config.baseUrl + LoginV1.ajaxUrls.phoneSendMsg, data);
    },
    
    tencentPhoneSendMsg: function() {
        LoginV1.hideError();

        if (LoginV1.ajaxLock) return false;

        var handelEle = function(){
            if(LoginV1.config.tab =='qq'){
                $("#slideMask").addClass('active');
            }else{
                $(".mask").removeClass('hidden');
            }
        };
        
        var callbackFun = function(retJson) {
            $(".mask").addClass('hidden');
           
            if(retJson.ret == 0) {
                LoginV1.setSigAndCode(retJson);
                var data = LoginV1.buildBaseData();
                var areaId = $.trim($('#phonearea').text());
                var mobilePhone = $.trim($('#phonemobile').val());
                data.phoneIsAbroad = areaId == '+86' ? 0 : 1;
                data.auto = LoginV1.getCookie('al') || '',
                data.inputUserId = areaId+mobilePhone,
                data.sessionKey = LoginV1.codeKey,
                data.type = 1,
                data.validateCode = LoginV1.code + ';'+ LoginV1.sig,
                data.needRegister = LoginV1.config.needRegister || 0,
                data.method = 'LoginV1.phoneSendMsgCallback';

                LoginV1.ajaxLock = true;
                $('#sendPhoneMsg').addClass('disabled');
                
                LoginV1.jsonp(LoginV1.config.baseUrl + LoginV1.ajaxUrls.phoneSendMsg, data);
            } else {
                //LoginV1.showError('验证不正确，请重新验证');
            }
        };

        if(LoginV1.validateSrc != ''){
            LoginV1.setCaptchaType(LoginV1.validateSrc);
            if (LoginV1.config.getslidejs == 1){
                if(!LoginV1.captchaType) handelEle();
                LoginV1.refreshCaptcha('cap_iframe',callbackFun);
            }else{
                LoginV1.config.getslidejs = 1;
                LoginV1.getScript(LoginV1.validateSrc, function() {
                    if(!LoginV1.captchaType) handelEle();
                    LoginV1.showCaptcha('cap_iframe',callbackFun);
                });
            }
        }
    },

    phoneSendMsgCallback: function(data) {
        LoginV1.ajaxLock = false;
        if(data.code != 0){
            $('#sendPhoneMsg').removeClass('disabled');
            LoginV1.showError(data.message);
            return false;
        }


        LoginV1.sessionKey = data.data.sessionKey;
        if(data.data.nextAction == 0){
            $('#phonecode').focus();
            LoginV1.phoneInterval($('#sendPhoneMsg'));
            return false;
        }

        LoginV1.validateSrc = data.data.imgSrc;
        LoginV1.codeKey = data.data.sessionKey;
        if(data.data.nextAction == 8){
            $('#sendPhoneMsg').removeClass('disabled');
            $('#img-code-input').show();
            $('#imgCode').attr('src',LoginV1.validateSrc);
        }else if(data.data.nextAction == 11){
            $('#img-code-input').hide();
            LoginV1.tencentPhoneSendMsg();
        }
    },
    
    phoneInterval: function(obj) {
        var count = obj.children('i').length > 0 ? parseInt(obj.children('i').text()) : 60;
        var interval = setInterval(function() {
            count--;
            if (count <= 0) {
                LoginV1.codeKey = '';
                clearInterval(interval);
                obj.html('重新发送验证码').removeClass('disabled');
            }
            else {
                obj.html("(<i>" + count + "</i>)重新发送");
            }
        }, 1000);
    },
    
    phoneCodeLogin: function() {
        var data = LoginV1.buildBaseData();
        data.auto = LoginV1.config.autoLoginFlag || 0,
            data.inputUserId = $.trim($('#phonemobile').val()),
            data.sessionKey = LoginV1.sessionKey,
            data.validateCode = $.trim($('#phonecode').val()),
            data.method = 'LoginV1.phoneCodeLoginCallback';

        LoginV1.hideError();
        if (LoginV1.ajaxLock || $('.login-button').hasClass('loading')) {
            return;
        }
        LoginV1.ajaxLock = true;
        $('.login-button').addClass('loading');
        LoginV1.showTopImage();

        LoginV1.jsonp(LoginV1.config.baseUrl + LoginV1.ajaxUrls.phoneCodeLogin, data);
    },

    phoneCodeLoginCallback: function(data){
        LoginV1.ajaxLock = false;
        $('.login-button').removeClass('loading');
        if(data.code != 0){
            LoginV1.showError(data.message,data.code);
            return false;
        }
        data.data.nextAction = 0;
        LoginV1.loginCallback(data);
    },
    
    initPhoneAreaSelect: function(){
		var data = GPhoneArea;
		var hotArea = data.hot;		
		var areaHtml = '<ul id="hot_area">';
		$.each(hotArea, function(key, area){
			areaHtml += '<li onclick="LoginV1.setPhoneCode(' + area.code + ', \'' + area.chineseName +'\')"><a href="javascript:">' + area.chineseName + '<span>+' + area.code + '</span></a></li>';
		});
		areaHtml += '</ul>';			
		$.each(data, function(key, areaArr){
			if(key == 'hot') return;
			areaHtml += '<h3 id="' + key.toUpperCase() + '"> ' + key.toUpperCase() + ' </h3>';
			areaHtml += '<ul>';
			$.each(areaArr, function(key1, area) {
				areaHtml += '<li onclick="LoginV1.setPhoneCode(' + area.code + ', \'' + area.chineseName +'\')"><a href="javascript:">' + area.chineseName + '<span>+' + area.code + '</span></a></li>';
			})
			areaHtml += '</ul>';
		});
		
		$(".area-list").html(areaHtml);
		var letterHtml = '<dl>';
		for(var i = 0; i < 26; i++) {
			letterHtml += '<dd><a href="#' + String.fromCharCode(65+i) + '">' + String.fromCharCode(65+i) + '</a></dd>';
		}
		letterHtml += '</dl>';
		$(".letter").html(letterHtml);
	},
    
    setPhoneCode: function(code, name){
        if(code != ''){
            $('#phonearea').text('+'+code);
        }
        
        $("#section_phone_area").animate(
        {
            opacity:0.7,
            translateX:'100%'
        },
        200,
        'ease-out',
        function() {
            $('#section_phone_area').hide();
            $('.letter').hide();
            $(".wrapper").show();
        });
    },
    
    showReadNovelTip: function() {
        if (LoginV1.config.loginPostfix == '') return false;
        if ((new Date()) > (new Date(LoginV1.config.endShowNoveTipDate))) {
            return false;
        }
        var readNovelTip = LoginV1.getCookie('rednovel' + LoginV1.config.appId); // 该cookie为1表示第一个弹窗
        if (readNovelTip == '' || readNovelTip == undefined || readNovelTip != 11) {
            $('#usernameSpan').html($('#username').val() + LoginV1.config.loginPostfix);
            $('#readNovelTip').show();
            $('body').append('<div class="mask"></div>');
            LoginV1.setCookie('rednovel' + LoginV1.config.appId, 11, (new Date()).AddDays(30), '/');
            setTimeout(function() { LoginV1.readNovelTimer(); }, 1000);
            return true;
        }
        return false;
    },
    
    readNovelTimer: function() {
        var timer = $('#timer').text();
        timer = parseInt(timer);
        if (isNaN(timer)) return;
        timer--;
        if (timer <= 0) {
        	$("#nove-close").attr('href', "javascript:LoginV1.isCloseNove=true;$('#readNovelTip').hide();$('.mask').remove();void(0);");
        	$("#nove-close").html('知道了');
            $("#readNovelTip a").show();
        	return;
        }
        $('#timer').text(timer);
        setTimeout(function() { LoginV1.readNovelTimer(); }, 1000);
    },
    
    showYanbaTip: function() {
        // 初始化言吧登录事件
        if ((new Date().getTime()) > (new Date(LoginV1.config.endShowNoveFirstTipDate).getTime())) { // 忘记密码没有注册事件
            $('#forgetPsw').attr('href', $('#forgetPsw').attr('data-href'));
        } else {
            $('#forgetPsw').on('click', function() {
                $('#yanbaForgetPswTip a').hide();
                $('#yanbaForgetPswTip .close').show();
                $('#yanbaForgetPswTip #yanbaPswTimer').text(5);
                
                $('#yanbaForgetPswTip').show();
                $('body').append('<div class="mask"></div>');
                LoginV1.tipTimer('#yanbaPswTimer', function() { 
                    $('#yanbaForgetPswTip a').show();
                    $('#yanbaForgetPswTip .close').hide();
                    $('#yanbaForgetPswTip .gotoAq').off('click').on('click', function() {
                        $('.login-wrap').show();
                        $('#yanbaForgetPswTip').hide();
                        $('.mask').remove();
                    });
                });
            });
        }
        
        var ywtab = LoginV1.getCookie('ywtab');
        if (ywtab == 'qidian') return false;
        
        if ((new Date().getTime()) > (new Date(LoginV1.config.endShowNoveFirstTipDate).getTime())) {
            return false;
        }
        var readNovelTip = LoginV1.getCookie('rednovel'+LoginV1.config.appId);
        if (readNovelTip == '' || readNovelTip == undefined || readNovelTip < 3) {
            // 三次后弹窗1，不再展现
            readNovelTip = parseInt(readNovelTip);
            if (isNaN(readNovelTip)) readNovelTip = 0;
            LoginV1.setCookie('rednovel'+LoginV1.config.appId, readNovelTip + 1, (new Date()).AddDays(30), '/');
            
            $('body').append('<div class="mask"></div>');
            $('#yanbaFirstTip').show();
            LoginV1.tipTimer('#yanbaTimer', function() { 
                $('#yanbaFirstTip .popup-btn').hide();
                $('#yanbaFirstTip .two-btn').show();
                $('#closeYanbaTip').off('click').on('click', function() {
                    $('#yanbaFirstTip').remove();
                    $('.mask').remove();
                });
            });
        }
    },
    
    tipTimer: function(id, fun) {
        var timer = $(id).text();
        timer = parseInt(timer);
        if (isNaN(timer)) return;
        timer--;
        if (timer <= 0) {
        	if (typeof fun == 'function') {
                fun();
            }
        	return;
        }
        $(id).text(timer);
        setTimeout(function() { LoginV1.tipTimer(id, fun); }, 1000);
    },
    
    //确认登录
    relateQRCode: function() {
        var data = LoginV1.buildBaseData();
        data.qrcode = LoginV1.config.qrcode 
            data.method = 'LoginV1.relateQRCodeCallback';
            data.code = LoginV1.config.scanCode;
        LoginV1.jsonp(LoginV1.config.baseUrl + LoginV1.ajaxUrls.relateQRCode, data);
    },
    
    relateQRCodeCallback: function(data) {
        if (data && data.code == 0 && data.data) {
            if (LoginV1.config.isQQ || LoginV1.config.isWeixin) {
                $('#scanLogin').hide();
                $(".site-img").removeClass('error');
                $('.site-img p').html('登录成功');
                $('.login-btn a').hide();
            } else {
                location.href = LoginV1.config.closeLogin;
            }
        } else {
            $('#scanLogin').hide();
            $(".site-img").addClass('error');
            $('.site-img p').html(data.message || '二维码过期或者无法识别，请重新扫码');
            $('.login-btn a').hide();
            $('#reloadScanLogin').show();
        }
    },
    
    changeTab: function(tab) {
        switch (tab) {
            case 'qq':
                if (LoginV1.config.domain.indexOf('.qq.com') > -1) {
                    LoginV1.qq();
                } else {
                    LoginV1.qqWrap();
                }
                break;
            case 'weixin':
                LoginV1.weixin();
                break;
            default:
                /**if (LoginV1.config.domain.indexOf('.qidian.com') > -1) {
                    //LoginV1.qidian();
                } else {
                    LoginV1.qidianWrap();
                }*/
                $('#div_qqlogin iframe').remove();
                $('#div_weixinlogin iframe').remove();
                break;
        }
    },
    
    checkForm: function() {
        if($('#username').length <=0 || $('#password').length <= 0) return false;
        var username = $('#username').val().trim();
        var password = $('#password').val();
        if (username.length == 0) {
            return false;
        }
        if (password.length == 0) {
            return false;
        }
        
        if (LoginV1.nextAction == 8) {
            var code = $('#txtCode').val().trim();
            if (code.length == 0) {
                return false;
            }
        }
        return true;
    },
    
    checkPhoneForm: function() {
        // 检查手机号码
        var phonearea = $.trim($('#phonearea').text());   //  地区
        var phone = $.trim($('#phonemobile').val());         // 手机号

        if (phonearea.indexOf('+86') == 0) {
			var re = /^1\d{10}$/;
            if (re.test(phone) != true) return false;
        }else {
            var re = /^\d+$/;
            if (re.test(phone) != true) return false;
        }
        return true;
    },
    
    login: function(callbackMethod) {
        
        var username = $('#username').val();
        var password = $('#password').val();
        var autologin = LoginV1.config.autoLoginFlag || 0;
        var code = $('#txtCode').val();
        var url = LoginV1.nextAction === 0 ? LoginV1.ajaxUrls.staticLogin : LoginV1.ajaxUrls.checkCodeLogin;
        var data = LoginV1.buildBaseData();
            data.ywtoken = LoginV1.config.ywtoken,
            data.username = username,
            data.password = rsa_encryption(password),
            data.auto = autologin,
            data.code = code,
            data.method = callbackMethod || 'LoginV1.loginCallback';
            data.sessionkey = LoginV1.codeKey;

        if($('.tab-wrap .act').attr('tab') == 'tabReadX'){
            data.username += LoginV1.config.loginPostfix;
        }
        
        LoginV1.hideError();
        
        if (LoginV1.ajaxLock || $('.login-button').hasClass('loading')) {
            return;
        }
        
        LoginV1.ajaxLock = true;
        $('.login-button').addClass('loading');
        LoginV1.showTopImage();
        LoginV1.jsonp(LoginV1.config.baseUrl + url, data);
    },
    
    // 登录提示
    loginTip: function (data) {
        //var ywtab = LoginV1.config.loginPostfix == '' ? 1 : 0;
        //LoginV1.setCookie('ywtab', ywtab, (new Date()).AddDays(30), '/'); // 表示登录框tab
        LoginV1.loginSuccess(data);
    },
    
    // 高危账号提示
    riskTip: function(data) {
        if ($('#riskTip').length == 1 && data.isRiskAccount === true && LoginV1.getCookie('hightip') !== "1") {
            $('#riskTip').show();
            $('#staticLoginDv').hide();
            $('#ignoreTip').on('click', function() {
                LoginV1.loginTip(data); // 执行登录的提示
            });
            $('.noNeedWarnTip').on('click', function() {
                var ischecked = $(this).is(':checked') ? 1 : 0;
                LoginV1.setCookie('hightip', ischecked, (new Date()).AddDays(7), '/');
            });
            
            addStat('risk');
            return true;
        }
        
        return false;
    },
    
    loginCallback: function(data) {
        LoginV1.ajaxLock = false;
        var code = data ? data.code : -1;
        if (!data || code !== 0) { // 登录失败
            var error = LoginV1.errors[code] || data.message || LoginV1.errors[-1];
            $('.login-button').removeClass('loading');
            if(code == 10570){
                error = '登录失败，请点击<a href="javascript:location.reload();">刷新</a>重试';
            }
            
            LoginV1.showError(error);
            
            if (code == -11004 && data.data && data.data.imgSrc && data.nextAction > 0) { // 验证码出错的情况，继续做滑动验证码登录
                code = 0;
            } else {
                return;
            }
        }
        
        data = data.data;
        LoginV1.nextAction = data.nextAction;
        if (code === 0 && data.nextAction === 0) { // 登录成功
            $('.login-button').removeClass('loading'); 
            
            // 展现高危账号的提示
            if (!LoginV1.riskTip(data)) {
                addStat('login');
                LoginV1.loginTip(data); // 执行登录的提示
            }
            
            return;
        }
        
        $('.login-button').removeClass('loading');
        // 需要下一步校验
        if (data && data.nextAction) {
            switch (data.nextAction) {
                case 2: //重新认证静密
                    LoginV1.showError(-11020);
                    return;
                case 8: //图片验证码
                    LoginV1.showCheckCode(data.imgSrc);
                    LoginV1.codeKey = data.sessionKey;
                    $('.login-button').addClass('disabled');
                    return;
                case 11 : // 滑动验证码
                    LoginV1.showSlideCode(data.sessionKey,data.imgSrc);
                    return;
                case 12: // 手机验证码
                    LoginV1.showPhoneCode(data);
                    LoginV1.codeKey = data.sessionKey;
                    $('.login-button').addClass('disabled');
                    return;
                default:
                    LoginV1.showError(LoginV1.errors[-1]);
                    return;
            }
        }
    },
    
    // 展现手机短信验证码区
    showPhoneCode: function (data) {
        if(data.challenge == "undefined" || data.challenge == null || data.challenge == ''){
            LoginV1.showError('安全手机未绑定');
            return false;
        }
        
        $('#dvPhoneVerify .tip').html('').hide();
        if (LoginV1.countDownTimeout) {
            clearTimeout(LoginV1.countDownTimeout);
            $('#sendPhoneVerifyCode').removeClass('disabled');
            $('#sendPhoneVerifyCode').html('获取验证码').attr('data-disabled', 0);
        }
        
        $('#staticLoginDv').hide();
        $('#dvPhoneVerify').show();
        $('#phoneVerifyCode').val('');
        $('#sendMsgPhoneTips').html(data.challenge);
        
        $('#phoneVerifyCode').off('keyup').on('keyup', function() {
            $('#dvPhoneVerify .tip').hide();
            if ($(this).val().trim() != '') {
                $('#phoneCodeVerify').removeClass('disabled');
            } else {
                $('#phoneCodeVerify').addClass('disabled');
            }
        });
        
        $('#phoneCodeVerify').off('click').on('click', function(e) {
            LoginV1.phoneCodeVerify(e);
        });
        $('#sendPhoneVerifyCode').off('click').on('click', function() {
            LoginV1.sendPhoneVerifyCode();
        });
        $('.staticLogin').off('click').on('click', function() {
            LoginV1.showStaticLogin();
        });
    },
    
    // 展现静密登录
    showStaticLogin: function() {
        LoginV1.nextAction = 0;
        $('#staticLoginDv').show();
        $('#dvPhoneVerify').hide();
        LoginV1.staticLogin();
    },
    
    // 手机短信验证码校验，中风控时出现
    phoneCodeVerify: function(e) {
        e && e.preventDefault() && e.stopPropagation();
        try { e.cancelBubble = true; } catch(e) {}

        if ($('#phoneCodeVerify').hasClass('disabled')) {
            return;
        }
        
        // 检查是否有sessionKey
        if ($('#sendPhoneVerifyCode').attr('data-send') == 0) {
            LoginV1.showError('请点击发送手机短信验证码！');
            return;
        }
        
        // 检查是否有输入短信验证码
        var code = $('#phoneVerifyCode').val().trim();
        if (code == '') {
            LoginV1.showError('请输入手机短信验证码！');
            return;
        }
        
        if (LoginV1.ajaxLock || $('#phoneCodeVerify').hasClass('loading')) {
            return;
        }
        
        LoginV1.ajaxLock = true;
        $('#phoneCodeVerify').hasClass('loading');
        
        var url = LoginV1.ajaxUrls.phoneCodeVerify;
        var data = LoginV1.buildBaseData();
            data.method     = 'LoginV1.phoneCodeVerifyCallback';
            data.sessionkey = LoginV1.codeKey;
            data.code       = code;
        LoginV1.jsonp(LoginV1.config.baseUrl + url, data);
    },
    
    // 手机短信验证码校验 回调
    phoneCodeVerifyCallback: function(data) {
        LoginV1.ajaxLock = false;
        var code = data ? data.code : -1;
        if (code == 0) {
            // 校验成功，写登录态
            addStat('phoneverifylogin');
            LoginV1.loginTip(data.data); // 执行登录的提示
            return;
        }
        
        var error = LoginV1.errors[code] || data.message || LoginV1.errors[-1];
        
        if (code == -11003 || code == -10092) { // sessionKey 失效，重新返回登录界面
            LoginV1.showStaticLogin();
            LoginV1.showError('会话失效，请重试');
            return;
        }
        
        // 展示错误
        LoginV1.showError(error);
    },
    
    // 发送手机短信验证码
    sendPhoneVerifyCode: function(e) {
        if ($('#sendPhoneVerifyCode').attr('data-disabled') == 1) {
            return;
        }
        
        $('#sendPhoneVerifyCode').attr('data-send', 1);
        
        var url = LoginV1.ajaxUrls.sendPhoneVerifyCode;
        var data = LoginV1.buildBaseData();
            data.method     = 'LoginV1.sendPhoneVerifyCodeCallback';
            data.sessionkey = LoginV1.codeKey;
        
        $('#dvPhoneVerify .tip').hide();
        
        if (LoginV1.ajaxLock || $('#sendPhoneVerifyCode').hasClass('disabled')) {
            return;
        }
        
        LoginV1.ajaxLock = true;
        $('#sendPhoneVerifyCode').hasClass('disabled');
        LoginV1.jsonp(LoginV1.config.baseUrl + url, data);
    },
    
    // 发送手机短信验证码 回调函数
    sendPhoneVerifyCodeCallback: function(data) {
        LoginV1.ajaxLock = false;
        var code = data ? data.code : -1;
        if (code == 0) {
            // 发送成功
            // LoginV1.codeKey = data.data.sessionKey;
            
            // 按钮倒计时
            $('#sendPhoneVerifyCode').html('重新获取（120s）').attr('data-disabled', 1);
            LoginV1.countDown($('#sendPhoneVerifyCode'), 120, function() {
                $('#sendPhoneVerifyCode').removeClass('disabled');
                $('#sendPhoneVerifyCode').html('重新获取').attr('data-disabled', 0);
            });
            return;
        }
        
        var error = LoginV1.errors[code] || data.message || LoginV1.errors[-1];
        
        if (code == -11003 || code == -10092) { // sessionKey 失效，重新返回登录界面
            LoginV1.showStaticLogin();
            LoginV1.showError('会话失效，请重试');
            return;
        }
        
        // 展示错误
        $('#dvPhoneVerify .tip').html(error).show();
    },
    
    // 倒计时函数
    countDown: function(obj, times, func) {
        var text = obj.text();
        var match = text.match(/\d+/);
        if (match != null && match.length >= 1) { // 匹配到数字
            var remainSeconds = parseInt(match[0]);
            if (isNaN(remainSeconds)) remainSeconds = 0;
            
            if (remainSeconds == 0) {
                obj.text(text.replace(/\(\d+s\)/, ''));
                if (typeof func == 'function') func();
                return;
            }
            
            obj.text(text.replace(/\d+/, times));
        } else {
            // 没有匹配到数字
            obj.text(obj.text() + '(' + times + ')');
        }
        
        LoginV1.countDownTimeout = setTimeout(function() {
            LoginV1.countDown(obj, times - 1, func);
        }, 1000);
    },
    
    loginUbookCallback: function(data) {
        LoginV1.ajaxLock = false;
        var code = data ? data.code : -1;
        if (!data || code !== 0) { // 登录失败
            var error = LoginV1.errors[code] || data.message || LoginV1.errors[-1];
            LoginV1.ubookShowError(error);
            if (code == -11004 && data.data && data.data.imgSrc && data.nextAction > 0) { // 验证码出错的情况，继续做滑动验证码登录
                code = 0;
            } else {
                LoginV1.nextAction = 0;
                $('#dvCode').removeClass('active');
                window.location.hash = "";
                return;
            }
        }
        
        data = data.data;
        LoginV1.nextAction = data.nextAction;
        if (code === 0 && data.nextAction === 0) { // 登录成功
        
            LoginV1.loginUbookSuccess(data);
            return;
        }
        
        if (data && data.nextAction) {
            switch (data.nextAction) {
                case 2: //重新认证静密
                    code = -11020;
                    break;
                case 8: //图片验证码
                    LoginV1.showCheckCode(data.imgSrc);
                    $('#dvCode').addClass('active');
                    $('.ubookLogin').eq(1).removeClass('active');
                    window.location.hash = "#dvCode";
                    LoginV1.codeKey = data.sessionKey;
                    return;
                case 11 : // 滑动验证码
                    LoginV1.showSlideCode(data.sessionKey,data.imgSrc);
                    return;
                case 12: // 手机验证码
                    LoginV1.showPhoneCode(data);
                    LoginV1.codeKey = data.sessionKey;
                    $('.login-button').addClass('disabled');
                    return;
                default:
                    code = -1;
                    break;
            }
        }
        
        // 显示错误
        if (code !== 0) {
            var error = LoginV1.errors[code] || LoginV1.errors[-1];
            LoginV1.nextAction = 0;
            LoginV1.ubookShowError(error);
        }
    },
    
    ubookShowError: function(error) {
        $('.toast-popup .toast-content').text(error);
        $('.toast-popup').removeClass('hidden');
        setTimeout(function(){LoginV1.hideError()},3000);
        //$('#message').addClass('active');
        //$('#message .p_tc').text(error);
        //setTimeout(function() { $('#message').removeClass('active'); }, 3000);
    },
    
    loginUbookSuccess: function(data) {
        $('#dvCode').removeClass('active');
        window.location.hash = "";
        LoginV1.ubookShowError('登录成功');
        setTimeout(function() {
            if (LoginV1.config.format == 'jsonp') {
                LoginV1.config.method;
                return;
            }
            
            LoginV1.redirect(data.ticket, data.ywGuid, data.ywOpenId);
        }, 1000);
    },
    
    
    loginSuccess: function(data) {
        $('body').append(LoginV1.lightTip);
        $('.light-tip p').html('登录成功')
            .animate({
                opacity: 1,
             }, 500, 'ease-out');
        // 登录成功
        $('.light-tip p').remove();
        if (LoginV1.config.format == 'jsonp') {
            return;
        }

        //  查看是否需要302跳转，如果需要的话，先执行302跳转
        if (data['302url']) {
            location.href = data['302url'];
        } else {
            LoginV1.redirect(data.ticket, data.ywGuid, data.ywOpenId);
        }
    },
    
    checkStatus: function() {
        var data = LoginV1.buildBaseData();
            data.auto = LoginV1.getCookie('al') || '',
            data.method = 'LoginV1.checkStatusCallback';
        
        if (LoginV1.ajaxLock) {
            return;
        }
        
        LoginV1.ajaxLock = true;
        LoginV1.jsonp(LoginV1.config.baseUrl + LoginV1.ajaxUrls.checkStatus, data);
        
        return false;
    },
    
    checkStatusCallback: function(data) {
        LoginV1.ajaxLock = false;
        var code = data ? data.code : -1;
        var ticket = data && data.data ? data.data.ticket : '';
        
        if (code === 0 && ticket !== '') { // 校验成功
            LoginV1.loginSuccess(data.data);
            return true;
        }
    },
    
    getCaptcha: function() {
        var data = LoginV1.buildBaseData();
            data.force = 1;
        LoginV1.json(LoginV1.config.baseUrl + LoginV1.ajaxUrls.getCaptcha, data, function(data) {
            // todo 成功
        }, 'get');
    },
    
    getCaptchaNew: function(){
        var data = LoginV1.buildBaseData();
        data.force = 1 ;
        data.method = 'LoginV1.getCaptchaNewCallback';
        LoginV1.hideError();
        LoginV1.jsonp(LoginV1.config.baseUrl + LoginV1.ajaxUrls.getCaptchaNew, data);
    },

    getCaptchaNewCallback: function(data){
        if(data.code != 0){
            if(data.code == '-11002') data.message = '配置信息错误';
            LoginV1.showError(data.message,data.code);
            return false;
        }

        if(data.data.imgSrc == '' || !data.data.needValidateCode) return false;

        LoginV1.sig = '';
        LoginV1.code = '';
        LoginV1.codeKey = data.data.sessionKey;
        // 出腾讯验证码 隐藏图片验证码框
        if( data.data.imgSrc.indexOf('tencentCode;') == 0 ){
            //标识是否出腾讯验证码
            LoginV1.validateSrc = data.data.imgSrc.slice(12);
            LoginV1.setCaptchaType(LoginV1.validateSrc);
            LoginV1.phoneSendMsg();
        }else{
            console.log('不该出图片验证码的');
        }
    },
    
    refreshCode: function() {
        var url = $('#imgCode').attr('src');
        if (url.indexOf('&r=') > -1) {
            url = url.substr(0, url.indexOf('&r='));
        }
        url += '&r=' + (Math.random() * 10);
        $('#imgCode').attr('src', url);
    },
    
    validate: function(ticket) {
        var data = LoginV1.buildBaseData();
            data.ticket = ticket;
        LoginV1.jsonp(LoginV1.config.baseUrl + LoginV1.ajaxUrls.validateTicket, data, LoginV1.config.method);
    },
    
    logout: function() {
        var data = LoginV1.buildBaseData();
            data.autoTicket = LoginV1.getCookie('al');
        
        LoginV1.jsonp(LoginV1.config.baseUrl + LoginV1.ajaxUrls.logout, data, LoginV1.config.method);
    },
    
    showCheckCode: function(url) {
        LoginV1.currentType = 1;
        $('#imgCode').attr('src', url);
        $('#imgCode').parent().parent().removeClass('hidden');
        
        $('#txtCode').val('').focus();
    },
    
    setParam: function(key, value) {
        LoginV1.config[key] = value;
    },
    
    setParams: function(params) {
        for(var _key in params) {
            LoginV1.config[_key] = params[_key];
        }
    },
    
    buildBaseData: function() {
        return {
            appId: LoginV1.config.appId, 
            areaId: LoginV1.config.areaId, 
            source: LoginV1.config.source, 
            returnurl: LoginV1.config.returnUrl, 
            version: LoginV1.config.version, 
            imei: LoginV1.config.imei,
            qimei: LoginV1.config.qimei,
            ticket: LoginV1.config.ticket,
            autotime: LoginV1.config.autoTime,
            auto: LoginV1.config.autoLoginFlag || 0,
            sdkversion: LoginV1.config.sdkversion
        };
    },
    
    buildBaseDataString: function() {
        var data = LoginV1.buildBaseData();
        var url = '';
        for (var key in data) {
            url += key + '=' + encodeURIComponent(data[key]) + '&';
        }
        return url;
    },
    
    notifyClose: function(e) {
        e && e.preventDefault();
        var e = {};
        e.action = "close";
        LoginV1.crossMessage(e),
        LoginV1.cancelLogin();
    },
    
    cancelLogin: function() {
        window.clearInterval(LoginV1.loginClock),
        window.clearTimeout(LoginV1.loginTimeout),
        LoginV1.loginInvalid = !0
        
        $('#div_qqlogin iframe').remove();
        $('#div_weixinlogin iframe').remove();
        LoginV1.currentType = 0;
    },
    
    isPopupStyle: function() {
        return LoginV1.config.popup === 1;
    },
    
    isUIStyle: function() {
        return LoginV1.config.popup !== 1;
    },
    
    qidianWrap: function() {
        var iframe = '<iframe id="qidian_login_frame" name="qidian_login_frame" frameborder="0" scrolling="no" width="100%" height="100%" src="' + LoginV1.config.qqBaseUrl + LoginV1.qqWrapUrl + '?' + LoginV1.buildBaseDataString() + '"></iframe>';
        $('#div_qidianlogin').html(iframe);
    },
    
    qqWrap: function() {
        var iframe = '<iframe id="qq_login_frame" name="qq_login_frame" frameborder="0" scrolling="no" width="100%" height="100%" src="' + LoginV1.config.qqBaseUrl + LoginV1.qqWrapUrl + '?' + LoginV1.buildBaseDataString() + '"></iframe>';
        $('#div_qqlogin').html(iframe);
    },
    
    qq: function() {
        var url = LoginV1.qqWtUrl + encodeURIComponent(LoginV1.config.qqBaseUrl + '/mobile/qqptcallback');
        if (window.top != window.self) {
            window.top.location.href = url;
        } else {
            location.href = url;
        }
    },
    
    weixin: function() {
        var url = LoginV1.config.baseUrl + LoginV1.weixinWrapUrl + '?' + LoginV1.buildBaseDataString();
        var weixinWrapIframe = LoginV1.weixinWrapIframe;
        url += '&domain=' + encodeURIComponent(LoginV1.config.domain) + '&target=' + LoginV1.config.target + '&popup=' + LoginV1.config.popup;
        weixinWrapIframe.html('<iframe name="ui_weixinwraplogin" id="ui_weixinwraplogin" allowtransparency="true" scrolling="no" frameborder="0" width="100%" height="100%" style="top:0; left:0;' + "border-radius:5px;" + '" src="' + url + '">');
    },
    
    json2str: function(json) {
        var data = "";
        if ("undefined" != typeof JSON)
            data = JSON.stringify(json);
        else {
            var arr = [];
            for(var key in json)
                arr.push('"' + key + '":"' + json[key] + '"');
            data = "{" + arr.join(",") + "}"
        }
        
        return data;
    },
    
    uiStyleAgent: function(t) {
        var e = /^https:\/\/ssl./.test(location.href),
            i = encodeURIComponent(LoginV1.json2str(t)),
            n = document.location.protocol + "//" + (e ? "ssl." : "") + "ui.ptlogin2." + LoginV1.domain + "/cross_proxy.html#" + i,
            o = $("#proxy");
        o && (o.html('<iframe  allowtransparency="true" scrolling="no" frameborder="0" width="1" height="1" src="' + n + '">'));
    },
    
    crossMessage: function(t) {
        if (LoginV1.isUIStyle && LoginV1.uiStyleAgent(t), "undefined" != typeof window.postMessage)
            window.parent.postMessage(LoginV1.json2str(t), "*");
        else if (LoginV1.agentUrl) {
            var e = LoginV1.agentUrl + "#";
        
            for (var i in t) 
                e += i + "=" + t[i] + "&";
            $("#proxy") && ($("#proxy").html('<iframe src="' + encodeURI(e) + '"></iframe>'));
        } else try {
            navigator.ywlogincallback && navigator.ywlogincallback(LoginV1.json2str(t))
        } catch (n) {
            console.log("ptlogincallback " + n.message)
        }
    },
    
    getCookie: function(name) {
        var arg = name + '=';
        var alen = arg.length;
        var clen = document.cookie.length,
            i = 0;
        while (i < clen) {
            var j = i + alen;
            if (document.cookie.substring(i, j) == arg) {
                var _endstr = document.cookie.indexOf(';', j);
                if (_endstr == -1) _endstr = document.cookie.length;
                return unescape(document.cookie.substring(j, _endstr));
            }
            i = document.cookie.indexOf(' ', i) + 1;
            if (i == 0) break;
        };
        return null;
    },
    
    setCookie: function(name, value) {
        var argv = LoginV1.setCookie.arguments;
        var argc = LoginV1.setCookie.arguments.length;
        var expires = (argc > 2) ? argv[2] : null;
        var path = (argc > 3) ? argv[3] : null;
        var domain = (argc > 4) ? argv[4] : null;
        var secure = (argc > 5) ? argv[5] : false;
        document.cookie = name + '=' + escape(value) + ((expires == null) ? '' : ('; expires=' + expires.toGMTString())) + ((path == null) ? '' : ('; path=' + path)) + ((domain == null) ? '' : ('; domain=' + domain)) + ((secure == true) ? '; secure' : '');
    },
    
    deleteCookie: function(name) {
        var domain = LoginV1.domain;
        if (arguments != null && arguments.length >= 2) {
            domain = arguments[1];
        }
        LoginV1.setCookie(name, -1, (new Date()).AddDays(-1), '/', domain);
    },
    
    redirect: function(ticket, ywGuid, ywOpenId) {
        var url = LoginV1.config.returnUrl;
        if (url.indexOf('?') === -1) {
            url += '?';
        } else {
            url += '&';
        }
        if (LoginV1.config.popup == 1 && LoginV1.config.target == 'callback') {
            var data = {
                'code': 0,
                'data': {
                    'ywOpenId': ywOpenId,
                    'ywGuid': ywGuid,
                    'ticket': ticket
                }
            };
            LoginV1.notifyClose(data);
        } else {
            if (LoginV1.config.ticket != '0' && LoginV1.config.ticket != '') {
                url += 'ticket=' + ticket + '&ywguid=' + ywGuid + '&ywopenid=' + ywOpenId + '&';
            }
            url = url.substr(0, url.length - 1);
            window[LoginV1.config.target === 'iframe' ? 'self' : 'top'].location = url;
        }
    },
    
    showError: function(msg) {
        LoginV1.ubookShowError(msg);
        //$('.error-tip').html(msg).removeClass('hidden');
    },
    
    hideError: function() {
        $('.toast-popup').addClass('hidden');
        //$('#message').removeClass('active');
        //$('.error-tip').html('').addClass('hidden');
    },
    
    json: function(url, data, callback, method) {
        LoginV1.ajaxProxy(
                url, data, callback, method
            );
        return;
        $.ajax({
            type: method || "post",
            url: url,
            data: data,
            dataType: "json",
            success: callback || function (data) {},
            timeout: 3000
        });
    },
    
    jsonp: function(url, data, success) {
        data.format = 'jsonp';
        
        $.ajax({
            type: "get",
            url: url,
            data: data,
            dataType: "jsonp",
            success: success || function() {},
            error: function(xhr, status, err) {
                if (err) {
                    LoginV1.ajaxLock = false;
                }
            },
            timeout: 12000,
            complete : function(XMLHttpRequest,status){ //请求完成后最终执行参数
                if (url.toLowerCase().indexOf('checkstatus') == -1) {
                    if (LoginV1.ajaxLock == true) {
                        LoginV1.showError('网络异常，请稍后再试');
                        LoginV1.ubookShowError('网络异常，请稍后再试');
                        $('.login-button').removeClass('loading');
                    }
                }
                LoginV1.ajaxLock = false;
            }
        });
    },
    
    ajaxProxy: function(url, data, callback, method) {
        document.domain="qidian.com";
        var proxyId = '__yw_login_js_proxy__';
        var proxyUrl = LoginV1.config.cssPath + '/js/proxy.js';
        var iframe = document.getElementById(proxyId);
        if (!iframe) {
            iframe = document.createElement('iframe');
            iframe.id = proxyId;
            iframe.src = proxyUrl;
            iframe.style.display = 'none';
            document.body.insertBefore(iframe, document.body.childNodes[0]);
        }

        var iserroraccess = 0;
        try { if (iframe.contentWindow.ajax) { } } catch (e) { iserroraccess = 1 };
        if (iserroraccess == 0 && iframe.contentWindow.ajax) {
            new iframe.contentWindow.ajax(url, data, callback, method);
        }
    },
    
    inputScroll: function(inputObj) {
    	if(typeof LoginV1.safeData.pageHeight == 'undefined') {
    		LoginV1.safeData = {
	            pageHeight: $('.page-index').height(),
	            scrollTops: {}
	        };
    	}
    	var agent = navigator.userAgent;
        var re = /(iphone)|(ipad)|(itouch)/gi;
        if (re.test(agent)) return;
        
        var id = inputObj.attr('id');
        if (id == undefined) return;
        $('.page-index').height(LoginV1.safeData.pageHeight + 100);
        var scrollTop = LoginV1.safeData.scrollTops[id] || -1;
        if (scrollTop == -1) {
            scrollTop = inputObj.offset().top + $('body').scrollTop();
            LoginV1.safeData.scrollTops[id] = scrollTop;
        }
        
        setTimeout(function(){$('body').scrollTop(scrollTop-80);}, 500);
    },
    
    jump: function() {
        if (LoginV1.config.code == 0) { // 表示登录成功
            if (LoginV1.getCookie('rednovel'+LoginV1.config.appId) != 11) { // 登录成功后写cookie，不再弹窗1
                LoginV1.setCookie('rednovel'+LoginV1.config.appId, 3, (new Date()).AddDays(30), '/');
            }
            
            // 如果没有returnUrl，则跳转至起点首页
            var url = LoginV1.config.returnUrl || 'http://www.qidian.com';
            if (LoginV1.config.refreshParent != undefined && LoginV1.config.refreshParent == 1) {
                var hasDone = false;
                
                if(window.opener != null && window.opener != self){	
                     try{
                        var domain = document.domain.split('.');
                        var length = domain.length;
                        if (length >= 2) {
                            domain = domain[length - 2] + '.' + domain[length - 1];
                            document.domain = domain;
                        } else {
                            document.domain = 'qidian.com';
                        }
                        window.opener.jump(url);
                        window.opener = null;
                        window.open("","_self");
                        hasDone = true; 
                        
                        window.close(); 
                   } catch (e) { };
                }
                if (!hasDone) {
                    top.href = url;
                }
                else {
                    setTimeout(function() {
                        top.href = url;
                    }, 1000);
                }
            } else {
                if (LoginV1.config.target == 'callback') {
                    LoginV1.notifyClose();
                } else {
                    top.location = url;
                }
            }
        } else {
            $('#error').html(LoginV1.config.message);
        }
    },
    // 出滑动验证码 start
    showSlideCode:function (sessionKey,url) {
        LoginV1.currentType = 12;
        LoginV1.sessionKey = sessionKey;
        LoginV1.setCaptchaType(url);

        $('#cap_iframe').html('');
        if(!LoginV1.captchaType) var url = url + "&clientype=1";

        var handelEle = function(){
            //如果是qq阅读
            if(LoginV1.config.tab =='qq'){
                $("#slideMask").addClass('active');
            }else{
                $(".mask").removeClass('hidden');
            }
        };
            
        var callbackFun = function(retJson) {
            LoginV1.nextAction = 0;
            if(!LoginV1.captchaType){
                if(LoginV1.config.tab =='qq') $("#slideMask").removeClass('active');
                else $(".mask").addClass('hidden');
            }
           
            if(retJson.ret == 0) {
                LoginV1.setSigAndCode(retJson);
                var ret = LoginV1.buildBaseData();
                ret.ywtoken = LoginV1.config.ywtoken;
                ret.sig = LoginV1.sig;
                ret.code = LoginV1.code;
                ret.sessionkey = LoginV1.sessionKey ;
                ret.username = $("#username").val().trim();
                if($('.tab-wrap .act').attr('tab') == 'tabReadX'){
                    ret.username += LoginV1.config.loginPostfix;
                }
                ret.password = rsa_encryption($("#password").val());
                ret.logintype = 23 ;
                ret.auto = 1;
                ret.method = 'LoginV1.slideVerifyCodeLoginCallback';

                LoginV1.showTopImage();

                LoginV1.jsonp(LoginV1.config.baseUrl + LoginV1.ajaxUrls.checkCodeLogin,ret);

            } else {
                //LoginV1.showError('验证不正确，请重新验证');
            }
        };

        if (LoginV1.config.getslidejs == 1){
            if(!LoginV1.captchaType) handelEle();
            LoginV1.refreshCaptcha('cap_iframe',callbackFun);
        }else{
            LoginV1.config.getslidejs = 1;
            LoginV1.getScript(url, function() {
                if(!LoginV1.captchaType) handelEle();
                LoginV1.showCaptcha('cap_iframe',callbackFun);
            });
        }
    },

    setSigAndCode: function (retJson) {
        if(!LoginV1.captchaType){
            var ticket = capGetTicket();
            LoginV1.sig = ticket.ticket;
            LoginV1.code = ticket.randstr;
        }else if(LoginV1.captchaType == 1){
            LoginV1.sig = retJson.ticket;
            LoginV1.code = retJson.randstr;
        }
    },

    setCaptchaType: function (url) {
        LoginV1.captchaType = url.indexOf("ssl.captcha.qq.com/TCaptcha.js") > 0 ? 1 : 0;
    },

    showCaptcha: function (capName, callbackFun) {
        if (!LoginV1.captchaType){
            //显示验证码
            var capOption={callback:callbackFun, type:"popup", firstvrytype:1};
            capInit(document.getElementById(capName), capOption);
            //回调函数：验证码页面关闭时回调
        } else if(LoginV1.captchaType == 1) {
            LoginV1.captchaObj = new TencentCaptcha( document.getElementById(capName), LoginV1.captchaAppId, callbackFun);
            LoginV1.captchaObj.show();
        }
    },

    refreshCaptcha: function (capName,callbackFun) {
        if (!LoginV1.captchaType){
            capRefresh();
        } else if(LoginV1.captchaType == 1) {
            LoginV1.captchaObj = new TencentCaptcha( document.getElementById(capName), LoginV1.captchaAppId, callbackFun);
            LoginV1.captchaObj.show();
        }
    },



    getScript : function(url, callback) {
         var head = document.getElementsByTagName('head')[0],
            js = document.createElement('script');

        js.setAttribute('type', 'text/javascript'); 
        js.setAttribute('src', url); 
 
        head.appendChild(js);
        //执行回调
        var callbackFn = function(){
                if(typeof callback === 'function'){
                    callback();
                }
            };
 
         if (document.all) { //IE
             js.onreadystatechange = function() {
                 if (js.readyState == 'loaded' || js.readyState == 'complete') {
                    callbackFn();
                 }
            }
        } else {
             js.onload = function() {
                 callbackFn();
             }
        }
    },
    
    slideVerifyCodeLoginCallback : function (data) {
        if (LoginV1.isUbook()) { // 如果ubook登录界面
           LoginV1.loginUbookCallback(data);
        } else {
           LoginV1.loginCallback(data);
        }
    },
    
    isUbook: function() {
        var t = LoginV1.config.domain;
        // 不是起点，并且不是yuewen站点，则认为是ubook
        return t.indexOf('qidian.com') === -1 && t.indexOf('yuewen.com') === -1;
    }
};

Date.prototype.AddDays = function(interval) {
    var dateObj = this;
    var millisecond = 1;
    var second = millisecond * 1000;
    var minute = second * 60;
    var hour = minute * 60;
    var day = hour * 24;
    var year = day * 365;

    var newDate;
    var dVal = new Date(dateObj);
    dVal = dVal.valueOf();

    newDate = new Date(dVal + day * interval);
    newDate = new Date(newDate);
    return newDate;
};

function jump(url) {
    top.location = url;
}

function rsa_encryption(password) {
    var rsa = new RSAKey();
    rsa.setPublic(LoginV1.config.modulus, LoginV1.config.exponent);  // 生成公钥
    var encrypt_password = rsa.encrypt(password);   // 加密数据
    if (encrypt_password.length > 50) {
        return encrypt_password ;
    }else{
        return password ;
    }
}

function addStat(name){
    try{
        if(Statistics == 'undefined' || Statistics == null) return false;
        Statistics.loginSuc(name);
    }catch (e) {}
}

if (typeof window.postMessage !== 'undefined') {
    window.onmessage = function(event) {
        var msg = event || window.event; // 兼容IE8
        var data;

        try{
            if (typeof msg.data !== "object"){
                if (typeof JSON !== 'undefined') // IE7兼容模式不存在JSON对象
                    data = JSON.parse(msg.data);
                else
                    data = str2JSON(msg.data);
            }

            switch (data.message.type) {
                case 6:
                    $('#tcaptcha_transform').remove();
                    break;
                default: //什么也不做，便于我们扩展接口
                    break;
            }

        }catch(e){}
    }
}

/**
 * [str2JSON 降字符串转换成json对象（供业务参考）]
 * @param  {String} str [json字符串]
 * @return {Object}
 */
function str2JSON(msg) {
    // borrow from jquery
    var rvalidchars = /^[\],:{}\s]*$/,
        rvalidbraces = /(?:^|:|,)(?:\s*\[)+/g,
        rvalidescape = /\\(?:["\\\/bfnrt]|u[\da-fA-F]{4})/g,
        rvalidtokens = /"[^"\\\r\n]*"|true|false|null|-?(?:\d+\.|)\d+(?:[eE][+-]?\d+|)/g;
    
    if (rvalidchars.test(msg.replace(rvalidescape, "@")
        .replace(rvalidtokens, "]")
        .replace(rvalidbraces, "")) ) {
            return (new Function("return " + msg))();
        }
    return {};
}var dbits;var canary=0xdeadbeefcafe;var j_lm=((canary&0xffffff)==0xefcafe);function BigInteger(a,b,c){if(a!=null)if("number"==typeof a)this.fromNumber(a,b,c);else if(b==null&&"string"!=typeof a)this.fromString(a,256);else this.fromString(a,b)}function nbi(){return new BigInteger(null)}function am1(i,x,w,j,c,n){while(--n>=0){var v=x*this[i++]+w[j]+c;c=Math.floor(v/0x4000000);w[j++]=v&0x3ffffff}return c}function am2(i,x,w,j,c,n){var xl=x&0x7fff,xh=x>>15;while(--n>=0){var l=this[i]&0x7fff;var h=this[i++]>>15;var m=xh*l+h*xl;l=xl*l+((m&0x7fff)<<15)+w[j]+(c&0x3fffffff);c=(l>>>30)+(m>>>15)+xh*h+(c>>>30);w[j++]=l&0x3fffffff}return c}function am3(i,x,w,j,c,n){var xl=x&0x3fff,xh=x>>14;while(--n>=0){var l=this[i]&0x3fff;var h=this[i++]>>14;var m=xh*l+h*xl;l=xl*l+((m&0x3fff)<<14)+w[j]+c;c=(l>>28)+(m>>14)+xh*h;w[j++]=l&0xfffffff}return c}if(j_lm&&(navigator.appName=="Microsoft Internet Explorer")){BigInteger.prototype.am=am2;dbits=30}else if(j_lm&&(navigator.appName!="Netscape")){BigInteger.prototype.am=am1;dbits=26}else{BigInteger.prototype.am=am3;dbits=28}BigInteger.prototype.DB=dbits;BigInteger.prototype.DM=((1<<dbits)-1);BigInteger.prototype.DV=(1<<dbits);var BI_FP=52;BigInteger.prototype.FV=Math.pow(2,BI_FP);BigInteger.prototype.F1=BI_FP-dbits;BigInteger.prototype.F2=2*dbits-BI_FP;var BI_RM="0123456789abcdefghijklmnopqrstuvwxyz";var BI_RC=new Array();var rr,vv;rr="0".charCodeAt(0);for(vv=0;vv<=9;++vv)BI_RC[rr++]=vv;rr="a".charCodeAt(0);for(vv=10;vv<36;++vv)BI_RC[rr++]=vv;rr="A".charCodeAt(0);for(vv=10;vv<36;++vv)BI_RC[rr++]=vv;function int2char(n){return BI_RM.charAt(n)}function intAt(s,i){var c=BI_RC[s.charCodeAt(i)];return(c==null)?-1:c}function bnpCopyTo(r){for(var i=this.t-1;i>=0;--i)r[i]=this[i];r.t=this.t;r.s=this.s}function bnpFromInt(x){this.t=1;this.s=(x<0)?-1:0;if(x>0)this[0]=x;else if(x<-1)this[0]=x+DV;else this.t=0}function nbv(i){var r=nbi();r.fromInt(i);return r}function bnpFromString(s,b){var k;if(b==16)k=4;else if(b==8)k=3;else if(b==256)k=8;else if(b==2)k=1;else if(b==32)k=5;else if(b==4)k=2;else{this.fromRadix(s,b);return}this.t=0;this.s=0;var i=s.length,mi=false,sh=0;while(--i>=0){var x=(k==8)?s[i]&0xff:intAt(s,i);if(x<0){if(s.charAt(i)=="-")mi=true;continue}mi=false;if(sh==0)this[this.t++]=x;else if(sh+k>this.DB){this[this.t-1]|=(x&((1<<(this.DB-sh))-1))<<sh;this[this.t++]=(x>>(this.DB-sh))}else this[this.t-1]|=x<<sh;sh+=k;if(sh>=this.DB)sh-=this.DB}if(k==8&&(s[0]&0x80)!=0){this.s=-1;if(sh>0)this[this.t-1]|=((1<<(this.DB-sh))-1)<<sh}this.clamp();if(mi)BigInteger.ZERO.subTo(this,this)}function bnpClamp(){var c=this.s&this.DM;while(this.t>0&&this[this.t-1]==c)--this.t}function bnToString(b){if(this.s<0)return"-"+this.negate().toString(b);var k;if(b==16)k=4;else if(b==8)k=3;else if(b==2)k=1;else if(b==32)k=5;else if(b==4)k=2;else return this.toRadix(b);var km=(1<<k)-1,d,m=false,r="",i=this.t;var p=this.DB-(i*this.DB)%k;if(i-->0){if(p<this.DB&&(d=this[i]>>p)>0){m=true;r=int2char(d)}while(i>=0){if(p<k){d=(this[i]&((1<<p)-1))<<(k-p);d|=this[--i]>>(p+=this.DB-k)}else{d=(this[i]>>(p-=k))&km;if(p<=0){p+=this.DB;--i}}if(d>0)m=true;if(m)r+=int2char(d)}}return m?r:"0"}function bnNegate(){var r=nbi();BigInteger.ZERO.subTo(this,r);return r}function bnAbs(){return(this.s<0)?this.negate():this}function bnCompareTo(a){var r=this.s-a.s;if(r!=0)return r;var i=this.t;r=i-a.t;if(r!=0)return r;while(--i>=0)if((r=this[i]-a[i])!=0)return r;return 0}function nbits(x){var r=1,t;if((t=x>>>16)!=0){x=t;r+=16}if((t=x>>8)!=0){x=t;r+=8}if((t=x>>4)!=0){x=t;r+=4}if((t=x>>2)!=0){x=t;r+=2}if((t=x>>1)!=0){x=t;r+=1}return r}function bnBitLength(){if(this.t<=0)return 0;return this.DB*(this.t-1)+nbits(this[this.t-1]^(this.s&this.DM))}function bnpDLShiftTo(n,r){var i;for(i=this.t-1;i>=0;--i)r[i+n]=this[i];for(i=n-1;i>=0;--i)r[i]=0;r.t=this.t+n;r.s=this.s}function bnpDRShiftTo(n,r){for(var i=n;i<this.t;++i)r[i-n]=this[i];r.t=Math.max(this.t-n,0);r.s=this.s}function bnpLShiftTo(n,r){var bs=n%this.DB;var cbs=this.DB-bs;var bm=(1<<cbs)-1;var ds=Math.floor(n/this.DB),c=(this.s<<bs)&this.DM,i;for(i=this.t-1;i>=0;--i){r[i+ds+1]=(this[i]>>cbs)|c;c=(this[i]&bm)<<bs}for(i=ds-1;i>=0;--i)r[i]=0;r[ds]=c;r.t=this.t+ds+1;r.s=this.s;r.clamp()}function bnpRShiftTo(n,r){r.s=this.s;var ds=Math.floor(n/this.DB);if(ds>=this.t){r.t=0;return}var bs=n%this.DB;var cbs=this.DB-bs;var bm=(1<<bs)-1;r[0]=this[ds]>>bs;for(var i=ds+1;i<this.t;++i){r[i-ds-1]|=(this[i]&bm)<<cbs;r[i-ds]=this[i]>>bs}if(bs>0)r[this.t-ds-1]|=(this.s&bm)<<cbs;r.t=this.t-ds;r.clamp()}function bnpSubTo(a,r){var i=0,c=0,m=Math.min(a.t,this.t);while(i<m){c+=this[i]-a[i];r[i++]=c&this.DM;c>>=this.DB}if(a.t<this.t){c-=a.s;while(i<this.t){c+=this[i];r[i++]=c&this.DM;c>>=this.DB}c+=this.s}else{c+=this.s;while(i<a.t){c-=a[i];r[i++]=c&this.DM;c>>=this.DB}c-=a.s}r.s=(c<0)?-1:0;if(c<-1)r[i++]=this.DV+c;else if(c>0)r[i++]=c;r.t=i;r.clamp()}function bnpMultiplyTo(a,r){var x=this.abs(),y=a.abs();var i=x.t;r.t=i+y.t;while(--i>=0)r[i]=0;for(i=0;i<y.t;++i)r[i+x.t]=x.am(0,y[i],r,i,0,x.t);r.s=0;r.clamp();if(this.s!=a.s)BigInteger.ZERO.subTo(r,r)}function bnpSquareTo(r){var x=this.abs();var i=r.t=2*x.t;while(--i>=0)r[i]=0;for(i=0;i<x.t-1;++i){var c=x.am(i,x[i],r,2*i,0,1);if((r[i+x.t]+=x.am(i+1,2*x[i],r,2*i+1,c,x.t-i-1))>=x.DV){r[i+x.t]-=x.DV;r[i+x.t+1]=1}}if(r.t>0)r[r.t-1]+=x.am(i,x[i],r,2*i,0,1);r.s=0;r.clamp()}function bnpDivRemTo(m,q,r){var pm=m.abs();if(pm.t<=0)return;var pt=this.abs();if(pt.t<pm.t){if(q!=null)q.fromInt(0);if(r!=null)this.copyTo(r);return}if(r==null)r=nbi();var y=nbi(),ts=this.s,ms=m.s;var nsh=this.DB-nbits(pm[pm.t-1]);if(nsh>0){pm.lShiftTo(nsh,y);pt.lShiftTo(nsh,r)}else{pm.copyTo(y);pt.copyTo(r)}var ys=y.t;var y0=y[ys-1];if(y0==0)return;var yt=y0*(1<<this.F1)+((ys>1)?y[ys-2]>>this.F2:0);var d1=this.FV/yt,d2=(1<<this.F1)/yt,e=1<<this.F2;var i=r.t,j=i-ys,t=(q==null)?nbi():q;y.dlShiftTo(j,t);if(r.compareTo(t)>=0){r[r.t++]=1;r.subTo(t,r)}BigInteger.ONE.dlShiftTo(ys,t);t.subTo(y,y);while(y.t<ys)y[y.t++]=0;while(--j>=0){var qd=(r[--i]==y0)?this.DM:Math.floor(r[i]*d1+(r[i-1]+e)*d2);if((r[i]+=y.am(0,qd,r,j,0,ys))<qd){y.dlShiftTo(j,t);r.subTo(t,r);while(r[i]<--qd)r.subTo(t,r)}}if(q!=null){r.drShiftTo(ys,q);if(ts!=ms)BigInteger.ZERO.subTo(q,q)}r.t=ys;r.clamp();if(nsh>0)r.rShiftTo(nsh,r);if(ts<0)BigInteger.ZERO.subTo(r,r)}function bnMod(a){var r=nbi();this.abs().divRemTo(a,null,r);if(this.s<0&&r.compareTo(BigInteger.ZERO)>0)a.subTo(r,r);return r}function Classic(m){this.m=m}function cConvert(x){if(x.s<0||x.compareTo(this.m)>=0)return x.mod(this.m);else return x}function cRevert(x){return x}function cReduce(x){x.divRemTo(this.m,null,x)}function cMulTo(x,y,r){x.multiplyTo(y,r);this.reduce(r)}function cSqrTo(x,r){x.squareTo(r);this.reduce(r)}Classic.prototype.convert=cConvert;Classic.prototype.revert=cRevert;Classic.prototype.reduce=cReduce;Classic.prototype.mulTo=cMulTo;Classic.prototype.sqrTo=cSqrTo;function bnpInvDigit(){if(this.t<1)return 0;var x=this[0];if((x&1)==0)return 0;var y=x&3;y=(y*(2-(x&0xf)*y))&0xf;y=(y*(2-(x&0xff)*y))&0xff;y=(y*(2-(((x&0xffff)*y)&0xffff)))&0xffff;y=(y*(2-x*y%this.DV))%this.DV;return(y>0)?this.DV-y:-y}function Montgomery(m){this.m=m;this.mp=m.invDigit();this.mpl=this.mp&0x7fff;this.mph=this.mp>>15;this.um=(1<<(m.DB-15))-1;this.mt2=2*m.t}function montConvert(x){var r=nbi();x.abs().dlShiftTo(this.m.t,r);r.divRemTo(this.m,null,r);if(x.s<0&&r.compareTo(BigInteger.ZERO)>0)this.m.subTo(r,r);return r}function montRevert(x){var r=nbi();x.copyTo(r);this.reduce(r);return r}function montReduce(x){while(x.t<=this.mt2)x[x.t++]=0;for(var i=0;i<this.m.t;++i){var j=x[i]&0x7fff;var u0=(j*this.mpl+(((j*this.mph+(x[i]>>15)*this.mpl)&this.um)<<15))&x.DM;j=i+this.m.t;x[j]+=this.m.am(0,u0,x,i,0,this.m.t);while(x[j]>=x.DV){x[j]-=x.DV;x[++j]++}}x.clamp();x.drShiftTo(this.m.t,x);if(x.compareTo(this.m)>=0)x.subTo(this.m,x)}function montSqrTo(x,r){x.squareTo(r);this.reduce(r)}function montMulTo(x,y,r){x.multiplyTo(y,r);this.reduce(r)}Montgomery.prototype.convert=montConvert;Montgomery.prototype.revert=montRevert;Montgomery.prototype.reduce=montReduce;Montgomery.prototype.mulTo=montMulTo;Montgomery.prototype.sqrTo=montSqrTo;function bnpIsEven(){return((this.t>0)?(this[0]&1):this.s)==0}function bnpExp(e,z){if(e>0xffffffff||e<1)return BigInteger.ONE;var r=nbi(),r2=nbi(),g=z.convert(this),i=nbits(e)-1;g.copyTo(r);while(--i>=0){z.sqrTo(r,r2);if((e&(1<<i))>0)z.mulTo(r2,g,r);else{var t=r;r=r2;r2=t}}return z.revert(r)}function bnModPowInt(e,m){var z;if(e<256||m.isEven())z=new Classic(m);else z=new Montgomery(m);return this.exp(e,z)}BigInteger.prototype.copyTo=bnpCopyTo;BigInteger.prototype.fromInt=bnpFromInt;BigInteger.prototype.fromString=bnpFromString;BigInteger.prototype.clamp=bnpClamp;BigInteger.prototype.dlShiftTo=bnpDLShiftTo;BigInteger.prototype.drShiftTo=bnpDRShiftTo;BigInteger.prototype.lShiftTo=bnpLShiftTo;BigInteger.prototype.rShiftTo=bnpRShiftTo;BigInteger.prototype.subTo=bnpSubTo;BigInteger.prototype.multiplyTo=bnpMultiplyTo;BigInteger.prototype.squareTo=bnpSquareTo;BigInteger.prototype.divRemTo=bnpDivRemTo;BigInteger.prototype.invDigit=bnpInvDigit;BigInteger.prototype.isEven=bnpIsEven;BigInteger.prototype.exp=bnpExp;BigInteger.prototype.toString=bnToString;BigInteger.prototype.negate=bnNegate;BigInteger.prototype.abs=bnAbs;BigInteger.prototype.compareTo=bnCompareTo;BigInteger.prototype.bitLength=bnBitLength;BigInteger.prototype.mod=bnMod;BigInteger.prototype.modPowInt=bnModPowInt;BigInteger.ZERO=nbv(0);BigInteger.ONE=nbv(1);
function Arcfour(){this.i=0;this.j=0;this.S=new Array()}function ARC4init(key){var i,j,t;for(i=0;i<256;++i)this.S[i]=i;j=0;for(i=0;i<256;++i){j=(j+this.S[i]+key[i%key.length])&255;t=this.S[i];this.S[i]=this.S[j];this.S[j]=t}this.i=0;this.j=0}function ARC4next(){var t;this.i=(this.i+1)&255;this.j=(this.j+this.S[this.i])&255;t=this.S[this.i];this.S[this.i]=this.S[this.j];this.S[this.j]=t;return this.S[(t+this.S[this.i])&255]}Arcfour.prototype.init=ARC4init;Arcfour.prototype.next=ARC4next;function prng_newstate(){return new Arcfour()}var rng_psize=256;
var rng_state;var rng_pool;var rng_pptr;function rng_seed_int(x){rng_pool[rng_pptr++]^=x&255;rng_pool[rng_pptr++]^=(x>>8)&255;rng_pool[rng_pptr++]^=(x>>16)&255;rng_pool[rng_pptr++]^=(x>>24)&255;if(rng_pptr>=rng_psize)rng_pptr-=rng_psize}function rng_seed_time(){rng_seed_int(new Date().getTime())}if(rng_pool==null){rng_pool=new Array();rng_pptr=0;var t;if(navigator.appName=="Netscape"&&navigator.appVersion<"5"&&window.crypto){var z=window.crypto.random(32);for(t=0;t<z.length;++t)rng_pool[rng_pptr++]=z.charCodeAt(t)&255}while(rng_pptr<rng_psize){t=Math.floor(65536*Math.random());rng_pool[rng_pptr++]=t>>>8;rng_pool[rng_pptr++]=t&255}rng_pptr=0;rng_seed_time()}function rng_get_byte(){if(rng_state==null){rng_seed_time();rng_state=prng_newstate();rng_state.init(rng_pool);for(rng_pptr=0;rng_pptr<rng_pool.length;++rng_pptr)rng_pool[rng_pptr]=0;rng_pptr=0}return rng_state.next()}function rng_get_bytes(ba){var i;for(i=0;i<ba.length;++i)ba[i]=rng_get_byte()}function SecureRandom(){}SecureRandom.prototype.nextBytes=rng_get_bytes;
function parseBigInt(str,r){return new BigInteger(str,r)}function linebrk(s,n){var ret="";var i=0;while(i+n<s.length){ret+=s.substring(i,i+n)+"\n";i+=n}return ret+s.substring(i,s.length)}function byte2Hex(b){if(b<0x10)return"0"+b.toString(16);else return b.toString(16)}function pkcs1pad2(s,n){if(n<s.length+11){alert("Message too long for RSA");return null}var ba=new Array();var i=s.length-1;while(i>=0&&n>0){var c=s.charCodeAt(i--);if(c<128){ba[--n]=c}else if((c>127)&&(c<2048)){ba[--n]=(c&63)|128;ba[--n]=(c>>6)|192}else{ba[--n]=(c&63)|128;ba[--n]=((c>>6)&63)|128;ba[--n]=(c>>12)|224}}ba[--n]=0;var rng=new SecureRandom();var x=new Array();while(n>2){x[0]=0;while(x[0]==0)rng.nextBytes(x);ba[--n]=x[0]}ba[--n]=2;ba[--n]=0;return new BigInteger(ba)}function RSAKey(){this.n=null;this.e=0;this.d=null;this.p=null;this.q=null;this.dmp1=null;this.dmq1=null;this.coeff=null}function RSASetPublic(N,E){if(N!=null&&E!=null&&N.length>0&&E.length>0){this.n=parseBigInt(N,16);this.e=parseInt(E,16)}else alert("Invalid RSA public key")}function RSADoPublic(x){return x.modPowInt(this.e,this.n)}function RSAEncrypt(text){var m=pkcs1pad2(text,(this.n.bitLength()+7)>>3);if(m==null)return null;var c=this.doPublic(m);if(c==null)return null;var h=c.toString(16);if((h.length&1)==0)return h;else return"0"+h}RSAKey.prototype.doPublic=RSADoPublic;RSAKey.prototype.setPublic=RSASetPublic;RSAKey.prototype.encrypt=RSAEncrypt;